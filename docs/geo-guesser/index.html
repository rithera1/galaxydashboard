<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>ğŸŒ Geo Guesser â€” Galaxy Dashboard</title>
<link rel="icon" href="../favicon.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --beige: #f5ead6;
  --beige-dark: #ecdcc0;
  --beige-darker: #e0c99a;
  --cream: #fdf6e8;
  --ink: #3b2f1e;
  --ink-light: #7a5c3a;
  --red: #e8453c;
  --orange: #f5832a;
  --yellow: #f7c948;
  --teal: #3dbfb0;
  --blue: #4a90d9;
  --purple: #9b6fda;
  --green: #5cbb6f;
  --pink: #e8668a;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--beige);
  font-family: 'Nunito', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  color: var(--ink);
}

/* â”€â”€ TOP BAR â”€â”€ */
.topbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.7rem 1.2rem;
  background: var(--cream);
  border-bottom: 3px solid var(--ink);
  position: sticky;
  top: 0;
  z-index: 100;
  gap: 0.5rem;
}

.topbar-left {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  flex-shrink: 0;
}

.back-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 0.95rem;
  color: var(--ink);
  text-decoration: none;
  background: var(--beige);
  border: 2.5px solid var(--ink);
  border-radius: 12px;
  padding: 0.3rem 0.75rem;
  transition: background 0.15s;
  white-space: nowrap;
}
.back-btn:hover { background: var(--beige-darker); }

.game-title {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(1.1rem, 3vw, 1.6rem);
  color: var(--ink);
}

.topbar-stats {
  display: flex;
  gap: 0.5rem;
  align-items: center;
  flex-wrap: wrap;
  justify-content: flex-end;
}

.stat-chip {
  font-family: 'Fredoka One', cursive;
  font-size: 0.9rem;
  padding: 0.25rem 0.65rem;
  border-radius: 20px;
  border: 2px solid var(--ink);
  white-space: nowrap;
}
.stat-chip.score-chip { background: #fef3c2; }
.stat-chip.round-chip { background: #dbeeff; }
.stat-chip.streak-chip { background: #fde0ea; }

/* â”€â”€ SCREENS â”€â”€ */
.screen {
  display: none;
  min-height: calc(100vh - 58px);
}
.screen.active { display: flex; flex-direction: column; }

/* â”€â”€ START SCREEN â”€â”€ */
#startScreen {
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem;
  text-align: center;
}

.start-globe {
  font-size: 5rem;
  animation: globeSpin 4s ease-in-out infinite;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.12));
  margin-bottom: 0.5rem;
}
@keyframes globeSpin {
  0%, 100% { transform: rotate(-8deg) scale(1); }
  50%       { transform: rotate(8deg) scale(1.05); }
}

.start-title {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(2rem, 7vw, 3.2rem);
  color: var(--ink);
  line-height: 1.1;
  margin-bottom: 0.4rem;
}
.start-title span { color: var(--blue); }

.start-sub {
  color: var(--ink-light);
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 2rem;
}

.mode-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  max-width: 680px;
  width: 100%;
  margin-bottom: 2rem;
}

.mode-card {
  background: var(--cream);
  border: 3px solid var(--ink);
  border-radius: 20px;
  padding: 1.4rem 0.8rem;
  cursor: pointer;
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.18s;
  box-shadow: 4px 4px 0 var(--ink);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  overflow: hidden;
}
.mode-card::after {
  content: '';
  position: absolute;
  inset: 0;
  border-radius: 17px;
  opacity: 0;
  transition: opacity 0.2s;
}
.mode-card:hover {
  transform: translateY(-5px) scale(1.03);
  box-shadow: 4px 4px 0 var(--ink), 0 0 24px 6px var(--glow);
}
.mode-card:hover::after { opacity: 1; }
.mode-card:active { transform: scale(0.97); }
.mode-card.selected {
  transform: translateY(-4px) scale(1.03);
  box-shadow: 4px 4px 0 var(--ink), 0 0 24px 8px var(--glow);
}
.mode-card.selected::before {
  content: 'âœ“';
  position: absolute;
  top: 8px; right: 10px;
  font-family: 'Fredoka One', cursive;
  font-size: 1.1rem;
  color: var(--ink);
}

.mode-card.m-states  { --glow: rgba(61,191,176,0.5); }
.mode-card.m-cities  { --glow: rgba(74,144,217,0.5); }
.mode-card.m-world   { --glow: rgba(155,111,218,0.5); }

.mode-card.m-states  { background: #d6f5f2; }
.mode-card.m-cities  { background: #dbeeff; }
.mode-card.m-world   { background: #ede0ff; }

.mode-emoji { font-size: 2.6rem; }
.mode-label {
  font-family: 'Fredoka One', cursive;
  font-size: 1.05rem;
  color: var(--ink);
}
.mode-desc {
  font-size: 0.75rem;
  color: var(--ink-light);
  font-weight: 700;
  text-align: center;
  line-height: 1.3;
}

.diff-row {
  display: flex;
  gap: 0.6rem;
  margin-bottom: 1.5rem;
  align-items: center;
}
.diff-label {
  font-family: 'Fredoka One', cursive;
  font-size: 0.95rem;
  color: var(--ink-light);
}
.diff-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 0.9rem;
  padding: 0.3rem 0.85rem;
  border-radius: 20px;
  border: 2.5px solid var(--ink);
  background: var(--cream);
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
}
.diff-btn:hover { background: var(--beige-darker); }
.diff-btn.active { background: var(--yellow); font-weight: 800; transform: scale(1.05); }

.start-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 1.35rem;
  padding: 0.85rem 3rem;
  background: var(--green);
  color: white;
  border: 3px solid var(--ink);
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.15s;
}
.start-btn:hover {
  transform: translateY(-3px) scale(1.04);
  box-shadow: 4px 4px 0 var(--ink), 0 0 20px 6px rgba(92,187,111,0.5);
}
.start-btn:active { transform: scale(0.97); box-shadow: 2px 2px 0 var(--ink); }
.start-btn:disabled {
  background: var(--beige-darker);
  color: var(--ink-light);
  cursor: not-allowed;
  box-shadow: 2px 2px 0 var(--ink);
  transform: none;
}

/* â”€â”€ GAME SCREEN â”€â”€ */
#gameScreen {
  flex: 1;
  display: none;
  flex-direction: column;
}
#gameScreen.active { display: flex; }

.question-bar {
  background: var(--cream);
  border-bottom: 3px solid var(--beige-darker);
  padding: 0.7rem 1.2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.8rem;
  flex-wrap: wrap;
}

.question-text {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(1.05rem, 3.5vw, 1.5rem);
  color: var(--ink);
  flex: 1;
}
.question-text span {
  color: var(--blue);
}

.timer-bar-wrap {
  width: 120px;
  height: 12px;
  background: var(--beige-dark);
  border-radius: 10px;
  border: 2px solid var(--ink);
  overflow: hidden;
  flex-shrink: 0;
}
.timer-bar-fill {
  height: 100%;
  background: var(--green);
  border-radius: 8px;
  transition: width 1s linear, background 0.5s;
  width: 100%;
}
.timer-bar-fill.warn { background: var(--orange); }
.timer-bar-fill.danger { background: var(--red); }

/* Map wrapper */
.map-wrap {
  flex: 1;
  position: relative;
  overflow: hidden;
  background: #b8d9f0;
  cursor: crosshair;
  user-select: none;
  min-height: 320px;
}

.map-wrap svg {
  width: 100%;
  height: 100%;
  display: block;
}

/* SVG map styling */
.map-wrap svg .country, .map-wrap svg .state {
  fill: #e8f4e8;
  stroke: #7aaa7a;
  stroke-width: 0.5;
  transition: fill 0.2s;
}
.map-wrap svg .country:hover, .map-wrap svg .state:hover {
  fill: #d0ebd0;
}
.map-wrap svg .country.answer-country, .map-wrap svg .state.answer-state {
  fill: #a8e6a8;
  stroke: var(--green);
  stroke-width: 1.5;
}

/* Guess marker */
.guess-pin, .answer-pin {
  position: absolute;
  transform: translate(-50%, -100%);
  pointer-events: none;
  filter: drop-shadow(0 3px 6px rgba(0,0,0,0.3));
  z-index: 10;
  transition: opacity 0.3s;
}
.guess-pin svg path { fill: var(--red); }
.answer-pin svg path { fill: var(--green); }

.distance-line {
  position: absolute;
  inset: 0;
  pointer-events: none;
  z-index: 9;
  overflow: visible;
}

/* Result overlay */
.result-overlay {
  position: absolute;
  bottom: 0;
  left: 0;
  right: 0;
  background: rgba(253,246,232,0.97);
  border-top: 3px solid var(--ink);
  padding: 1rem 1.4rem;
  display: none;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  z-index: 20;
  flex-wrap: wrap;
}
.result-overlay.show { display: flex; }

.result-info { flex: 1; min-width: 0; }
.result-name {
  font-family: 'Fredoka One', cursive;
  font-size: 1.3rem;
  color: var(--ink);
  margin-bottom: 0.2rem;
}
.result-detail {
  font-size: 0.85rem;
  color: var(--ink-light);
  font-weight: 700;
}

.result-score-badge {
  font-family: 'Fredoka One', cursive;
  font-size: 1.9rem;
  padding: 0.4rem 1.1rem;
  border-radius: 20px;
  border: 3px solid var(--ink);
  background: var(--yellow);
  white-space: nowrap;
  animation: popIn 0.35s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes popIn {
  from { transform: scale(0.4); opacity: 0; }
  to   { transform: scale(1); opacity: 1; }
}
.result-score-badge.perfect { background: #a8f0b0; }
.result-score-badge.great   { background: var(--yellow); }
.result-score-badge.ok      { background: #ffd4a0; }
.result-score-badge.poor    { background: #ffc0c0; }

.next-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 1.1rem;
  padding: 0.6rem 1.6rem;
  background: var(--blue);
  color: white;
  border: 3px solid var(--ink);
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 3px 3px 0 var(--ink);
  transition: transform 0.15s, box-shadow 0.15s;
  white-space: nowrap;
}
.next-btn:hover { transform: translateY(-2px); box-shadow: 3px 3px 0 var(--ink), 0 0 14px rgba(74,144,217,0.5); }
.next-btn:active { transform: scale(0.97); }

/* Hint bar */
.hint-bar {
  display: flex;
  gap: 0.5rem;
  padding: 0.5rem 1rem;
  align-items: center;
  background: var(--beige);
  border-bottom: 2px solid var(--beige-darker);
  flex-wrap: wrap;
}
.hint-label {
  font-family: 'Fredoka One', cursive;
  font-size: 0.85rem;
  color: var(--ink-light);
}
.hint-chip {
  font-family: 'Fredoka One', cursive;
  font-size: 0.78rem;
  padding: 0.2rem 0.65rem;
  border-radius: 20px;
  border: 2px solid var(--ink);
  background: var(--cream);
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
}
.hint-chip:hover { background: var(--yellow); transform: scale(1.05); }
.hint-chip:disabled, .hint-chip.used {
  opacity: 0.45;
  cursor: not-allowed;
  transform: none;
}

.hint-text {
  font-size: 0.82rem;
  color: var(--blue);
  font-weight: 700;
  margin-left: auto;
  animation: fadeIn 0.3s ease both;
}
@keyframes fadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: none; } }

/* Progress dots */
.progress-dots {
  display: flex;
  gap: 5px;
  padding: 0.5rem 1rem;
  justify-content: center;
  background: var(--beige);
  border-bottom: 2px solid var(--beige-darker);
}
.progress-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid var(--ink);
  background: var(--cream);
  transition: background 0.3s, transform 0.2s;
}
.progress-dot.done { background: var(--green); transform: scale(1.15); }
.progress-dot.current { background: var(--yellow); transform: scale(1.2); animation: pulse 1s ease infinite; }
@keyframes pulse { 0%,100%{box-shadow:0 0 0 0 rgba(247,201,72,0.5)} 50%{box-shadow:0 0 0 5px rgba(247,201,72,0)} }

/* â”€â”€ END SCREEN â”€â”€ */
#endScreen {
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem;
  text-align: center;
}

.end-trophy {
  font-size: 5rem;
  animation: trophyBounce 1s cubic-bezier(.34,1.56,.64,1) both;
  margin-bottom: 0.5rem;
}
@keyframes trophyBounce {
  from { transform: scale(0.3) translateY(40px); opacity: 0; }
  to   { transform: scale(1) translateY(0); opacity: 1; }
}

.end-title {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(1.8rem, 6vw, 2.8rem);
  color: var(--ink);
  margin-bottom: 0.3rem;
}
.end-final-score {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(2.5rem, 9vw, 4rem);
  color: var(--blue);
  margin-bottom: 0.3rem;
}
.end-rank {
  font-size: 1rem;
  color: var(--ink-light);
  font-weight: 700;
  margin-bottom: 1.5rem;
}

.score-breakdown {
  width: 100%;
  max-width: 500px;
  background: var(--cream);
  border: 3px solid var(--ink);
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 1.5rem;
  box-shadow: 4px 4px 0 var(--ink);
}
.breakdown-header {
  background: var(--ink);
  color: var(--cream);
  font-family: 'Fredoka One', cursive;
  font-size: 0.95rem;
  padding: 0.5rem 1rem;
  text-align: left;
}
.breakdown-row {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0.45rem 1rem;
  border-bottom: 1.5px solid var(--beige-dark);
  gap: 0.5rem;
  animation: slideIn 0.3s ease both;
}
.breakdown-row:last-child { border-bottom: none; }
@keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: none; } }
.breakdown-name {
  font-weight: 700;
  font-size: 0.85rem;
  flex: 1;
  text-align: left;
}
.breakdown-dist {
  font-size: 0.78rem;
  color: var(--ink-light);
  font-weight: 700;
  text-align: right;
}
.breakdown-pts {
  font-family: 'Fredoka One', cursive;
  font-size: 1rem;
  min-width: 55px;
  text-align: right;
  padding: 0.1rem 0.5rem;
  border-radius: 12px;
}
.breakdown-pts.pts-perfect { background: #a8f0b0; }
.breakdown-pts.pts-great   { background: #fef3c2; }
.breakdown-pts.pts-ok      { background: #ffd4a0; }
.breakdown-pts.pts-poor    { background: #ffc0c0; }

.end-actions {
  display: flex;
  gap: 0.75rem;
  flex-wrap: wrap;
  justify-content: center;
}
.btn-primary {
  font-family: 'Fredoka One', cursive;
  font-size: 1.15rem;
  padding: 0.7rem 2rem;
  background: var(--green);
  color: white;
  border: 3px solid var(--ink);
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.15s;
}
.btn-primary:hover { transform: translateY(-3px) scale(1.04); box-shadow: 4px 4px 0 var(--ink), 0 0 18px rgba(92,187,111,0.5); }

.btn-secondary {
  font-family: 'Fredoka One', cursive;
  font-size: 1.15rem;
  padding: 0.7rem 2rem;
  background: var(--cream);
  color: var(--ink);
  border: 3px solid var(--ink);
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1);
}
.btn-secondary:hover { transform: translateY(-3px) scale(1.04); background: var(--beige-darker); }

/* Confetti canvas */
#confettiCanvas {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 999;
}

/* Mobile tweaks */
@media (max-width: 600px) {
  .mode-grid { grid-template-columns: 1fr; max-width: 280px; }
  .question-bar { padding: 0.5rem 0.8rem; }
  .result-overlay { flex-direction: column; align-items: flex-start; }
  .timer-bar-wrap { width: 80px; }
}
@media (max-width: 768px) {
  .mode-grid { grid-template-columns: repeat(3, 1fr); }
}
</style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- TOP BAR -->
<div class="topbar">
  <div class="topbar-left">
    <a href="../" class="back-btn">â† Home</a>
    <div class="game-title">ğŸŒ Geo Guesser</div>
  </div>
  <div class="topbar-stats" id="topbarStats" style="display:none">
    <div class="stat-chip score-chip">â­ <span id="statScore">0</span></div>
    <div class="stat-chip round-chip">Round <span id="statRound">1</span>/10</div>
    <div class="stat-chip streak-chip">ğŸ”¥ <span id="statStreak">0</span></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â• START SCREEN â•â•â•â•â•â•â• -->
<div id="startScreen" class="screen active">
  <div class="start-globe">ğŸŒ</div>
  <h1 class="start-title">Geo <span>Guesser</span></h1>
  <p class="start-sub">Click the map to place where you think it is!</p>

  <div class="mode-grid">
    <div class="mode-card m-states" data-mode="states" onclick="selectMode('states')">
      <div class="mode-emoji">ğŸ—ºï¸</div>
      <div class="mode-label">US States</div>
      <div class="mode-desc">50 states on the US map</div>
    </div>
    <div class="mode-card m-cities" data-mode="cities" onclick="selectMode('cities')">
      <div class="mode-emoji">ğŸ™ï¸</div>
      <div class="mode-label">US Cities</div>
      <div class="mode-desc">Major American cities</div>
    </div>
    <div class="mode-card m-world" data-mode="world" onclick="selectMode('world')">
      <div class="mode-emoji">ğŸŒ</div>
      <div class="mode-label">Countries</div>
      <div class="mode-desc">Nations of the world</div>
    </div>
  </div>

  <div class="diff-row">
    <span class="diff-label">Rounds:</span>
    <button class="diff-btn active" onclick="setRounds(5,this)">5</button>
    <button class="diff-btn" onclick="setRounds(10,this)">10</button>
    <button class="diff-btn" onclick="setRounds(15,this)">15</button>
  </div>

  <button class="start-btn" id="startBtn" onclick="startGame()" disabled>Choose a mode to start!</button>
</div>

<!-- â•â•â•â•â•â•â• GAME SCREEN â•â•â•â•â•â•â• -->
<div id="gameScreen" class="screen">

  <!-- Progress dots -->
  <div class="progress-dots" id="progressDots"></div>

  <!-- Hint bar -->
  <div class="hint-bar">
    <span class="hint-label">ğŸ’¡ Hints:</span>
    <button class="hint-chip" id="hintBtn1" onclick="useHint(1)">Continent / Region</button>
    <button class="hint-chip" id="hintBtn2" onclick="useHint(2)">First Letter</button>
    <div class="hint-text" id="hintText"></div>
  </div>

  <!-- Question -->
  <div class="question-bar">
    <div class="question-text" id="questionText">Where is <span id="targetName">â€¦</span>?</div>
    <div class="timer-bar-wrap" title="Time remaining">
      <div class="timer-bar-fill" id="timerBar"></div>
    </div>
  </div>

  <!-- Map -->
  <div class="map-wrap" id="mapWrap" onclick="handleMapClick(event)">
    <!-- SVG injected by JS -->
    <svg id="mapSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1000 500" preserveAspectRatio="xMidYMid meet">
      <rect width="1000" height="500" fill="#b8d9f0"/>
    </svg>

    <!-- Distance line overlay -->
    <svg class="distance-line" id="distanceSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100" preserveAspectRatio="none">
      <line id="distanceLine" x1="0" y1="0" x2="0" y2="0" stroke="var(--red)" stroke-width="0.5"
            stroke-dasharray="2,1.5" opacity="0" marker-end="url(#arrowEnd)"/>
      <defs>
        <marker id="arrowEnd" markerWidth="3" markerHeight="3" refX="2" refY="1.5" orient="auto">
          <polygon points="0,0 3,1.5 0,3" fill="var(--red)"/>
        </marker>
      </defs>
    </svg>

    <!-- Pins rendered as positioned divs -->
    <div id="guessPin" class="guess-pin" style="display:none">
      <svg width="30" height="40" viewBox="0 0 30 40">
        <path d="M15 0 C7 0 1 6 1 14 C1 24 15 40 15 40 C15 40 29 24 29 14 C29 6 23 0 15 0Z" fill="#e8453c" stroke="#3b2f1e" stroke-width="2"/>
        <circle cx="15" cy="14" r="5" fill="white"/>
      </svg>
    </div>
    <div id="answerPin" class="answer-pin" style="display:none">
      <svg width="30" height="40" viewBox="0 0 30 40">
        <path d="M15 0 C7 0 1 6 1 14 C1 24 15 40 15 40 C15 40 29 24 29 14 C29 6 23 0 15 0Z" fill="#5cbb6f" stroke="#3b2f1e" stroke-width="2"/>
        <circle cx="15" cy="14" r="5" fill="white"/>
      </svg>
    </div>

    <!-- Result overlay -->
    <div class="result-overlay" id="resultOverlay">
      <div class="result-info">
        <div class="result-name" id="resultName"></div>
        <div class="result-detail" id="resultDetail"></div>
      </div>
      <div class="result-score-badge" id="resultBadge"></div>
      <button class="next-btn" id="nextBtn" onclick="nextQuestion()">Next â†’</button>
    </div>
  </div>

</div>

<!-- â•â•â•â•â•â•â• END SCREEN â•â•â•â•â•â•â• -->
<div id="endScreen" class="screen">
  <div class="end-trophy" id="endTrophy">ğŸ†</div>
  <div class="end-title" id="endTitle">Great Explorer!</div>
  <div class="end-final-score" id="endFinalScore">0 pts</div>
  <div class="end-rank" id="endRank"></div>

  <div class="score-breakdown" id="scoreBreakdown">
    <div class="breakdown-header">ğŸ“‹ Round by Round</div>
    <div id="breakdownRows"></div>
  </div>

  <div class="end-actions">
    <button class="btn-primary" onclick="startGame()">Play Again</button>
    <button class="btn-secondary" onclick="showStart()">Change Mode</button>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// DATA SETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// US States â€” approximate centroid in SVG coords [x%, y%] for a standard US map (0-100)
const US_STATES = [
  { name:"Alabama",       x:71.5, y:67.5, region:"Southeast" },
  { name:"Alaska",        x:14,   y:84,   region:"Far West" },
  { name:"Arizona",       x:22,   y:63,   region:"Southwest" },
  { name:"Arkansas",      x:63,   y:62,   region:"South Central" },
  { name:"California",    x:8,    y:52,   region:"West Coast" },
  { name:"Colorado",      x:33,   y:50,   region:"Mountain West" },
  { name:"Connecticut",   x:87,   y:33,   region:"New England" },
  { name:"Delaware",      x:84.5, y:38.5, region:"Mid-Atlantic" },
  { name:"Florida",       x:75,   y:80,   region:"Southeast" },
  { name:"Georgia",       x:73,   y:68,   region:"Southeast" },
  { name:"Hawaii",        x:24,   y:90,   region:"Pacific" },
  { name:"Idaho",         x:20,   y:28,   region:"Northwest" },
  { name:"Illinois",      x:66,   y:45,   region:"Midwest" },
  { name:"Indiana",       x:70,   y:43,   region:"Midwest" },
  { name:"Iowa",          x:59,   y:38,   region:"Midwest" },
  { name:"Kansas",        x:49,   y:52,   region:"Great Plains" },
  { name:"Kentucky",      x:72,   y:51,   region:"Southeast" },
  { name:"Louisiana",     x:62,   y:74,   region:"South" },
  { name:"Maine",         x:91,   y:20,   region:"New England" },
  { name:"Maryland",      x:83,   y:39,   region:"Mid-Atlantic" },
  { name:"Massachusetts", x:89,   y:30,   region:"New England" },
  { name:"Michigan",      x:70,   y:32,   region:"Great Lakes" },
  { name:"Minnesota",     x:58,   y:25,   region:"Upper Midwest" },
  { name:"Mississippi",   x:67,   y:68,   region:"South" },
  { name:"Missouri",      x:61,   y:50,   region:"Midwest" },
  { name:"Montana",       x:27,   y:20,   region:"Mountain West" },
  { name:"Nebraska",      x:47,   y:43,   region:"Great Plains" },
  { name:"Nevada",        x:15,   y:43,   region:"West" },
  { name:"New Hampshire", x:89,   y:26,   region:"New England" },
  { name:"New Jersey",    x:86,   y:37,   region:"Mid-Atlantic" },
  { name:"New Mexico",    x:29,   y:62,   region:"Southwest" },
  { name:"New York",      x:83,   y:30,   region:"Mid-Atlantic" },
  { name:"North Carolina",x:79,   y:57,   region:"Southeast" },
  { name:"North Dakota",  x:47,   y:22,   region:"Great Plains" },
  { name:"Ohio",          x:74,   y:42,   region:"Midwest" },
  { name:"Oklahoma",      x:49,   y:60,   region:"South Central" },
  { name:"Oregon",        x:11,   y:31,   region:"Pacific Northwest" },
  { name:"Pennsylvania",  x:81,   y:36,   region:"Mid-Atlantic" },
  { name:"Rhode Island",  x:89,   y:32,   region:"New England" },
  { name:"South Carolina",x:77,   y:62,   region:"Southeast" },
  { name:"South Dakota",  x:46,   y:31,   region:"Great Plains" },
  { name:"Tennessee",     x:70,   y:58,   region:"Southeast" },
  { name:"Texas",         x:46,   y:70,   region:"South Central" },
  { name:"Utah",          x:22,   y:46,   region:"Mountain West" },
  { name:"Vermont",       x:87,   y:25,   region:"New England" },
  { name:"Virginia",      x:81,   y:48,   region:"Mid-Atlantic" },
  { name:"Washington",    x:13,   y:18,   region:"Pacific Northwest" },
  { name:"West Virginia", x:78,   y:46,   region:"Mid-Atlantic" },
  { name:"Wisconsin",     x:64,   y:30,   region:"Midwest" },
  { name:"Wyoming",       x:30,   y:34,   region:"Mountain West" },
];

// US Cities â€” major cities with approximate positions on US map coords [x%, y%]
const US_CITIES = [
  { name:"New York City",    x:86,   y:34,   region:"Northeast", fact:"Most populous US city" },
  { name:"Los Angeles",      x:10,   y:57,   region:"West Coast", fact:"2nd most populous city" },
  { name:"Chicago",          x:67,   y:37,   region:"Midwest", fact:"The Windy City" },
  { name:"Houston",          x:53,   y:73,   region:"South Texas", fact:"Space City" },
  { name:"Phoenix",          x:22,   y:64,   region:"Southwest", fact:"Valley of the Sun" },
  { name:"Philadelphia",     x:85,   y:37,   region:"Mid-Atlantic", fact:"City of Brotherly Love" },
  { name:"San Antonio",      x:48,   y:75,   region:"South Texas", fact:"Near the Alamo" },
  { name:"San Diego",        x:12,   y:62,   region:"West Coast", fact:"America's Finest City" },
  { name:"Dallas",           x:52,   y:67,   region:"South Central", fact:"Big D" },
  { name:"San Jose",         x:7,    y:47,   region:"West Coast", fact:"Silicon Valley hub" },
  { name:"Austin",           x:50,   y:72,   region:"South Central", fact:"Keep Austin Weird!" },
  { name:"Jacksonville",     x:76,   y:73,   region:"Southeast", fact:"Largest city by area" },
  { name:"Fort Worth",       x:51,   y:66,   region:"South Central", fact:"Cowtown" },
  { name:"Columbus",         x:74,   y:42,   region:"Midwest", fact:"Ohio capital" },
  { name:"Charlotte",        x:78,   y:57,   region:"Southeast", fact:"Queen City" },
  { name:"Indianapolis",     x:70,   y:44,   region:"Midwest", fact:"Indy 500!" },
  { name:"San Francisco",    x:6,    y:46,   region:"West Coast", fact:"The Golden Gate city" },
  { name:"Seattle",          x:12,   y:17,   region:"Pacific Northwest", fact:"Emerald City" },
  { name:"Denver",           x:33,   y:48,   region:"Mountain West", fact:"Mile High City" },
  { name:"Nashville",        x:70,   y:57,   region:"Southeast", fact:"Music City" },
  { name:"Oklahoma City",    x:49,   y:60,   region:"South Central", fact:"OKC" },
  { name:"El Paso",          x:33,   y:70,   region:"Southwest", fact:"Sun City" },
  { name:"Boston",           x:90,   y:29,   region:"New England", fact:"Cradle of Liberty" },
  { name:"Portland",         x:11,   y:25,   region:"Pacific Northwest", fact:"City of Roses" },
  { name:"Las Vegas",        x:17,   y:51,   region:"Southwest", fact:"Entertainment capital" },
  { name:"Memphis",          x:65,   y:60,   region:"Southeast", fact:"Home of the Blues" },
  { name:"Atlanta",          x:72,   y:65,   region:"Southeast", fact:"The ATL" },
  { name:"Miami",            x:77,   y:85,   region:"Southeast", fact:"Magic City" },
  { name:"Minneapolis",      x:58,   y:25,   region:"Midwest", fact:"City of Lakes" },
  { name:"New Orleans",      x:63,   y:75,   region:"South", fact:"The Big Easy" },
];

// World Countries â€” approximate lat/lng converted to SVG % position
// Using equirectangular projection: x = (lng + 180) / 360 * 100, y = (90 - lat) / 180 * 100
function lngLatToXY(lng, lat) {
  return { x: (lng + 180) / 360 * 100, y: (90 - lat) / 180 * 100 };
}

const WORLD_COUNTRIES_RAW = [
  { name:"Afghanistan",   lat:33,    lng:65,    continent:"Asia" },
  { name:"Argentina",     lat:-34,   lng:-64,   continent:"South America" },
  { name:"Australia",     lat:-25,   lng:133,   continent:"Oceania" },
  { name:"Austria",       lat:47,    lng:14,    continent:"Europe" },
  { name:"Bangladesh",    lat:24,    lng:90,    continent:"Asia" },
  { name:"Belgium",       lat:50,    lng:4,     continent:"Europe" },
  { name:"Bolivia",       lat:-17,   lng:-65,   continent:"South America" },
  { name:"Brazil",        lat:-10,   lng:-55,   continent:"South America" },
  { name:"Cambodia",      lat:13,    lng:105,   continent:"Asia" },
  { name:"Canada",        lat:56,    lng:-96,   continent:"North America" },
  { name:"Chile",         lat:-35,   lng:-71,   continent:"South America" },
  { name:"China",         lat:35,    lng:105,   continent:"Asia" },
  { name:"Colombia",      lat:4,     lng:-72,   continent:"South America" },
  { name:"Cuba",          lat:22,    lng:-79,   continent:"Caribbean" },
  { name:"Czech Republic",lat:50,    lng:15,    continent:"Europe" },
  { name:"Denmark",       lat:56,    lng:10,    continent:"Europe" },
  { name:"Ecuador",       lat:-2,    lng:-77,   continent:"South America" },
  { name:"Egypt",         lat:26,    lng:30,    continent:"Africa" },
  { name:"Ethiopia",      lat:9,     lng:40,    continent:"Africa" },
  { name:"Finland",       lat:64,    lng:26,    continent:"Europe" },
  { name:"France",        lat:46,    lng:2,     continent:"Europe" },
  { name:"Germany",       lat:51,    lng:10,    continent:"Europe" },
  { name:"Ghana",         lat:8,     lng:-2,    continent:"Africa" },
  { name:"Greece",        lat:39,    lng:22,    continent:"Europe" },
  { name:"Guatemala",     lat:15,    lng:-90,   continent:"Central America" },
  { name:"Hungary",       lat:47,    lng:19,    continent:"Europe" },
  { name:"India",         lat:20,    lng:77,    continent:"Asia" },
  { name:"Indonesia",     lat:-5,    lng:120,   continent:"Asia" },
  { name:"Iran",          lat:32,    lng:53,    continent:"Asia" },
  { name:"Iraq",          lat:33,    lng:44,    continent:"Asia" },
  { name:"Ireland",       lat:53,    lng:-8,    continent:"Europe" },
  { name:"Israel",        lat:31,    lng:35,    continent:"Asia" },
  { name:"Italy",         lat:42,    lng:12,    continent:"Europe" },
  { name:"Japan",         lat:36,    lng:138,   continent:"Asia" },
  { name:"Jordan",        lat:31,    lng:36,    continent:"Asia" },
  { name:"Kazakhstan",    lat:48,    lng:68,    continent:"Asia" },
  { name:"Kenya",         lat:1,     lng:38,    continent:"Africa" },
  { name:"Madagascar",    lat:-20,   lng:47,    continent:"Africa" },
  { name:"Malaysia",      lat:4,     lng:109,   continent:"Asia" },
  { name:"Mexico",        lat:23,    lng:-102,  continent:"North America" },
  { name:"Morocco",       lat:32,    lng:-5,    continent:"Africa" },
  { name:"Mozambique",    lat:-18,   lng:35,    continent:"Africa" },
  { name:"Myanmar",       lat:17,    lng:96,    continent:"Asia" },
  { name:"Nepal",         lat:28,    lng:84,    continent:"Asia" },
  { name:"Netherlands",   lat:52,    lng:5,     continent:"Europe" },
  { name:"New Zealand",   lat:-41,   lng:174,   continent:"Oceania" },
  { name:"Nigeria",       lat:10,    lng:8,     continent:"Africa" },
  { name:"North Korea",   lat:40,    lng:127,   continent:"Asia" },
  { name:"Norway",        lat:64,    lng:10,    continent:"Europe" },
  { name:"Pakistan",      lat:30,    lng:69,    continent:"Asia" },
  { name:"Peru",          lat:-10,   lng:-75,   continent:"South America" },
  { name:"Philippines",   lat:13,    lng:122,   continent:"Asia" },
  { name:"Poland",        lat:52,    lng:20,    continent:"Europe" },
  { name:"Portugal",      lat:39,    lng:-8,    continent:"Europe" },
  { name:"Romania",       lat:46,    lng:25,    continent:"Europe" },
  { name:"Russia",        lat:60,    lng:100,   continent:"Europe/Asia" },
  { name:"Saudi Arabia",  lat:24,    lng:45,    continent:"Asia" },
  { name:"South Africa",  lat:-30,   lng:25,    continent:"Africa" },
  { name:"South Korea",   lat:36,    lng:128,   continent:"Asia" },
  { name:"Spain",         lat:40,    lng:-4,    continent:"Europe" },
  { name:"Sri Lanka",     lat:8,     lng:81,    continent:"Asia" },
  { name:"Sudan",         lat:15,    lng:30,    continent:"Africa" },
  { name:"Sweden",        lat:60,    lng:15,    continent:"Europe" },
  { name:"Switzerland",   lat:47,    lng:8,     continent:"Europe" },
  { name:"Syria",         lat:35,    lng:38,    continent:"Asia" },
  { name:"Taiwan",        lat:24,    lng:121,   continent:"Asia" },
  { name:"Tanzania",      lat:-6,    lng:35,    continent:"Africa" },
  { name:"Thailand",      lat:15,    lng:101,   continent:"Asia" },
  { name:"Turkey",        lat:39,    lng:35,    continent:"Asia/Europe" },
  { name:"Uganda",        lat:1,     lng:32,    continent:"Africa" },
  { name:"Ukraine",       lat:49,    lng:32,    continent:"Europe" },
  { name:"United Kingdom",lat:54,    lng:-2,    continent:"Europe" },
  { name:"United States", lat:38,    lng:-97,   continent:"North America" },
  { name:"Uruguay",       lat:-33,   lng:-56,   continent:"South America" },
  { name:"Uzbekistan",    lat:41,    lng:64,    continent:"Asia" },
  { name:"Venezuela",     lat:8,     lng:-66,   continent:"South America" },
  { name:"Vietnam",       lat:16,    lng:107,   continent:"Asia" },
  { name:"Yemen",         lat:15,    lng:48,    continent:"Asia" },
  { name:"Zambia",        lat:-14,   lng:28,    continent:"Africa" },
  { name:"Zimbabwe",      lat:-20,   lng:30,    continent:"Africa" },
];

const WORLD_COUNTRIES = WORLD_COUNTRIES_RAW.map(c => ({
  ...c,
  ...lngLatToXY(c.lng, c.lat),
  region: c.continent
}));

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let gameMode = null;
let totalRounds = 5;
let currentRound = 0;
let totalScore = 0;
let currentStreak = 0;
let roundResults = [];
let queue = [];
let currentTarget = null;
let timerInterval = null;
let timerSeconds = 0;
let maxSeconds = 20;
let guessLocked = false;
let hintsUsed = [];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UI HELPERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
  document.getElementById('topbarStats').style.display = (id === 'gameScreen') ? 'flex' : 'none';
}

function selectMode(mode) {
  gameMode = mode;
  document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`.mode-card[data-mode="${mode}"]`).classList.add('selected');
  const btn = document.getElementById('startBtn');
  btn.disabled = false;
  const labels = { states:'US States', cities:'US Cities', world:'Countries' };
  btn.textContent = `Start ${labels[mode]}! ğŸš€`;
}

function setRounds(n, el) {
  totalRounds = n;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function showStart() {
  showScreen('startScreen');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// MAP RENDERING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Minimal world outline paths (simplified polygons for major land masses)
// Using rough outline polygons â€” enough to give visual context
const WORLD_SVG_PATHS = `
<g id="landmasses">
<!-- North America -->
<path class="country" d="M 130,40 L 180,35 L 220,40 L 240,60 L 260,55 L 280,70 L 270,90 L 250,100 L 240,120 L 220,115 L 200,130 L 190,125 L 180,140 L 160,145 L 155,160 L 165,175 L 155,185 L 140,175 L 130,155 L 120,145 L 110,130 L 100,120 L 90,105 L 95,90 L 85,75 L 90,60 L 110,50 Z"/>
<!-- South America -->
<path class="country" d="M 225,175 L 250,170 L 270,180 L 280,200 L 285,225 L 278,250 L 265,280 L 255,300 L 240,310 L 225,295 L 215,270 L 210,245 L 215,220 L 210,200 Z"/>
<!-- Europe -->
<path class="country" d="M 455,30 L 490,28 L 510,35 L 520,45 L 510,55 L 520,60 L 515,70 L 500,68 L 490,75 L 475,72 L 465,60 L 455,55 L 450,45 Z"/>
<!-- Africa -->
<path class="country" d="M 465,115 L 500,110 L 520,120 L 530,140 L 525,170 L 530,195 L 520,220 L 505,240 L 490,250 L 475,245 L 460,225 L 450,200 L 448,175 L 455,150 L 458,130 Z"/>
<!-- Asia (simplified) -->
<path class="country" d="M 525,30 L 620,25 L 700,30 L 760,35 L 800,45 L 810,60 L 780,70 L 750,65 L 720,75 L 700,70 L 680,80 L 660,75 L 640,85 L 610,80 L 590,90 L 560,85 L 535,75 L 520,60 L 525,45 Z"/>
<!-- Australia -->
<path class="country" d="M 710,250 L 750,245 L 780,255 L 790,275 L 785,295 L 765,305 L 740,300 L 720,285 L 710,270 Z"/>
<!-- Japan (small) -->
<path class="country" d="M 778,75 L 788,70 L 795,78 L 790,88 L 780,90 L 774,83 Z"/>
<!-- UK (small) -->
<path class="country" d="M 451,38 L 457,35 L 462,40 L 460,48 L 453,50 L 449,44 Z"/>
<!-- Indonesia (rough) -->
<path class="country" d="M 665,190 L 700,185 L 730,188 L 740,198 L 720,205 L 690,200 L 665,198 Z"/>
<!-- New Zealand (small) -->
<path class="country" d="M 810,285 L 818,280 L 823,290 L 818,300 L 810,298 Z"/>
<!-- Greenland -->
<path class="country" d="M 340,10 L 390,8 L 410,18 L 400,35 L 375,40 L 350,35 L 335,22 Z"/>
<!-- Scandinavia -->
<path class="country" d="M 475,18 L 500,14 L 510,22 L 505,35 L 490,38 L 475,32 Z"/>
<!-- Philippines (small) -->
<path class="country" d="M 725,148 L 735,145 L 740,155 L 733,162 L 724,158 Z"/>
<!-- Madagascar -->
<path class="country" d="M 518,218 L 525,212 L 532,220 L 530,235 L 522,238 L 516,230 Z"/>
</g>
`;

// US map paths (simplified state outlines as a composite)
const US_SVG = `
<g id="usBg">
  <!-- Main continental US outline -->
  <path class="state" d="
    M 80,55 L 160,50 L 200,52 L 240,48 L 280,50 L 330,48 L 380,52 L 420,50 L 460,52
    L 500,50 L 540,52 L 580,48 L 620,52 L 660,50 L 700,52 L 740,50 L 780,55
    L 800,60 L 810,75 L 800,90 L 810,105 L 795,120 L 780,130 L 770,145
    L 760,160 L 750,175 L 730,185 L 710,195 L 700,205 L 680,215 L 660,220
    L 640,218 L 620,220 L 600,215 L 575,220 L 555,215 L 535,220 L 510,225
    L 490,218 L 460,222 L 440,218 L 420,225 L 395,220 L 370,215 L 340,210
    L 310,215 L 285,210 L 260,205 L 235,200 L 210,195 L 185,185 L 160,175
    L 140,160 L 125,148 L 110,135 L 95,120 L 85,105 L 80,90 L 82,75 Z
  "/>
  <!-- Florida peninsula -->
  <path class="state" d="M 700,205 L 715,215 L 725,230 L 730,248 L 725,262 L 715,270 L 705,262 L 698,248 L 695,232 L 698,218 Z"/>
  <!-- Texas -->
  <path class="state" d="M 390,220 L 440,218 L 460,222 L 465,235 L 462,255 L 455,268 L 445,278 L 430,282 L 415,278 L 400,270 L 385,260 L 375,245 L 375,230 Z"/>
  <!-- Alaska (small inset) -->
  <path class="state" d="M 85,265 L 145,258 L 175,268 L 185,285 L 175,300 L 150,308 L 120,305 L 95,295 L 83,280 Z"/>
  <!-- Hawaii (small inset) -->
  <path class="state" d="M 210,280 L 225,276 L 238,282 L 242,295 L 232,302 L 218,300 L 208,292 Z"/>

  <!-- State boundary lines (major ones) -->
  <!-- Mississippi River rough line -->
  <line x1="640" y1="52" x2="635" y2="220" stroke="#9aaa9a" stroke-width="0.8" opacity="0.7"/>
  <!-- Appalachian suggestion -->
  <line x1="740" y1="80" x2="715" y2="195" stroke="#9aaa9a" stroke-width="0.8" opacity="0.5"/>
  <!-- Rockies suggestion -->
  <line x1="310" y1="52" x2="305" y2="200" stroke="#9aaa9a" stroke-width="0.8" opacity="0.5"/>
  <!-- East/West line -->
  <line x1="80" y1="140" x2="800" y2="140" stroke="#9aaa9a" stroke-width="0.5" opacity="0.3"/>

  <!-- Compass rose -->
  <text x="870" y="85" font-size="11" fill="#5a7a5a" font-family="Fredoka One" opacity="0.7">N</text>
  <text x="870" y="220" font-size="11" fill="#5a7a5a" font-family="Fredoka One" opacity="0.7">S</text>
  <text x="830" y="155" font-size="11" fill="#5a7a5a" font-family="Fredoka One" opacity="0.7">W</text>
  <text x="910" y="155" font-size="11" fill="#5a7a5a" font-family="Fredoka One" opacity="0.7">E</text>
</g>
`;

function renderMap() {
  const svg = document.getElementById('mapSvg');
  if (gameMode === 'world') {
    svg.setAttribute('viewBox', '0 0 1000 500');
    svg.innerHTML = `
      <rect width="1000" height="500" fill="#b8d9f0"/>
      ${WORLD_SVG_PATHS}
      <!-- Equator line -->
      <line x1="0" y1="250" x2="1000" y2="250" stroke="#7aaa9a" stroke-width="0.8" stroke-dasharray="8,6" opacity="0.5"/>
      <!-- Grid lines -->
      <line x1="500" y1="0" x2="500" y2="500" stroke="#9ababa" stroke-width="0.5" opacity="0.3"/>
      <line x1="0" y1="167" x2="1000" y2="167" stroke="#9ababa" stroke-width="0.5" opacity="0.25"/>
      <line x1="0" y1="333" x2="1000" y2="333" stroke="#9ababa" stroke-width="0.5" opacity="0.25"/>
      <!-- Labels -->
      <text x="490" y="492" font-size="8" fill="#5a8a9a" font-family="Fredoka One" opacity="0.7">Equator</text>
      <text x="10" y="492" font-size="7" fill="#5a8a9a" font-family="Nunito" font-weight="700" opacity="0.6">Â© Geo Guesser</text>
    `;
  } else {
    // US map
    svg.setAttribute('viewBox', '0 0 1000 360');
    svg.innerHTML = `
      <rect width="1000" height="360" fill="#b8d9f0"/>
      ${US_SVG}
      <text x="10" y="352" font-size="7" fill="#5a8a9a" font-family="Nunito" font-weight="700" opacity="0.6">Â© Geo Guesser</text>
    `;
  }
}

// Convert data x%,y% to SVG pixel coords within the viewBox
function dataToSvgCoords(xPct, yPct) {
  if (gameMode === 'world') {
    return { x: xPct * 10, y: yPct * 5 };
  } else {
    // US map viewBox 0 0 1000 360
    // data coords use the same x/y pct scaled to the US map area
    // Continental US roughly spans x:[80,810], y:[50,285] in our SVG
    const svgX = 80 + (xPct / 100) * 730;
    const svgY = 50 + (yPct / 100) * 235;
    return { x: svgX, y: svgY };
  }
}

// Convert a click on the map-wrap div to data x%,y%
function clickToDataPct(event) {
  const rect = event.currentTarget.getBoundingClientRect();
  const xPct = ((event.clientX - rect.left) / rect.width) * 100;
  const yPct = ((event.clientY - rect.top) / rect.height) * 100;
  return { x: xPct, y: yPct };
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCORING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// Distance in "data pct" space â€” we use euclidean distance %
// For world mode, 1% â‰ˆ ~111km (lon) or ~200km (lat) scaled â€” approximate but good for fun
// Max reasonable distance world: ~70 units pct. US map: ~60 units pct.

function calcScore(dist) {
  // dist is euclidean in pct space
  // World scale: max dist ~80, full score threshold ~2
  // US scale: max dist ~60, full score threshold ~3
  const maxDist = (gameMode === 'world') ? 80 : 60;
  const perfect = (gameMode === 'world') ? 2.5 : 3;
  if (dist <= perfect) return 1000;
  const raw = Math.max(0, 1 - (dist - perfect) / (maxDist - perfect));
  return Math.round(raw * raw * 900); // quadratic dropoff, max 900 when not perfect
}

function scoreLabel(pts) {
  if (pts >= 950) return { label:'ğŸ¯ Perfect!', cls:'perfect' };
  if (pts >= 700) return { label:'â­ Great!',   cls:'great' };
  if (pts >= 400) return { label:'ğŸ‘ OK',        cls:'ok' };
  return                 { label:'ğŸ“ Off',       cls:'poor' };
}

function distanceDisplay(dist) {
  if (gameMode === 'world') {
    const km = Math.round(dist * 110);
    if (km < 5) return 'Spot on!';
    if (km < 100) return `~${km} km away`;
    return `~${Math.round(km/100)*100} km away`;
  } else {
    const mi = Math.round(dist * 35);
    if (mi < 10) return 'Spot on!';
    if (mi < 50) return `~${mi} miles away`;
    return `~${Math.round(mi/50)*50} miles away`;
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME FLOW
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

function startGame() {
  if (!gameMode) return;

  // Build shuffled queue
  const pool = gameMode === 'states' ? US_STATES
             : gameMode === 'cities' ? US_CITIES
             : WORLD_COUNTRIES;

  queue = shuffle([...pool]).slice(0, totalRounds);
  currentRound = 0;
  totalScore = 0;
  currentStreak = 0;
  roundResults = [];

  renderMap();
  showScreen('gameScreen');
  buildProgressDots();
  updateStats();
  loadQuestion();
}

function buildProgressDots() {
  const el = document.getElementById('progressDots');
  el.innerHTML = '';
  for (let i = 0; i < totalRounds; i++) {
    const d = document.createElement('div');
    d.className = 'progress-dot' + (i === 0 ? ' current' : '');
    d.id = `dot-${i}`;
    el.appendChild(d);
  }
}

function updateProgressDots() {
  for (let i = 0; i < totalRounds; i++) {
    const d = document.getElementById(`dot-${i}`);
    if (!d) continue;
    d.className = 'progress-dot';
    if (i < currentRound) d.classList.add('done');
    else if (i === currentRound) d.classList.add('current');
  }
}

function updateStats() {
  document.getElementById('statScore').textContent = totalScore.toLocaleString();
  document.getElementById('statRound').textContent = currentRound + 1;
  document.getElementById('statStreak').textContent = currentStreak;
}

function loadQuestion() {
  if (currentRound >= totalRounds) { showEndScreen(); return; }

  currentTarget = queue[currentRound];
  guessLocked = false;
  hintsUsed = [];

  // Reset UI
  document.getElementById('guessPin').style.display = 'none';
  document.getElementById('answerPin').style.display = 'none';
  document.getElementById('resultOverlay').classList.remove('show');
  document.getElementById('hintText').textContent = '';
  document.getElementById('hintBtn1').classList.remove('used');
  document.getElementById('hintBtn2').classList.remove('used');
  document.getElementById('hintBtn1').disabled = false;
  document.getElementById('hintBtn2').disabled = false;

  const distLine = document.getElementById('distanceLine');
  distLine.setAttribute('opacity', '0');

  document.getElementById('targetName').textContent = currentTarget.name;

  updateProgressDots();
  updateStats();
  startTimer();
}

function startTimer() {
  clearInterval(timerInterval);
  timerSeconds = maxSeconds;
  const bar = document.getElementById('timerBar');
  bar.style.width = '100%';
  bar.className = 'timer-bar-fill';

  timerInterval = setInterval(() => {
    timerSeconds--;
    const pct = (timerSeconds / maxSeconds) * 100;
    bar.style.width = pct + '%';
    if (pct < 33) bar.className = 'timer-bar-fill danger';
    else if (pct < 60) bar.className = 'timer-bar-fill warn';

    if (timerSeconds <= 0) {
      clearInterval(timerInterval);
      if (!guessLocked) timeUp();
    }
  }, 1000);
}

function timeUp() {
  // Reveal answer with 0 score
  revealAnswer(null, null);
}

function handleMapClick(event) {
  if (guessLocked) return;

  const pt = clickToDataPct(event);
  placeGuess(pt.x, pt.y);
}

function placeGuess(xPct, yPct) {
  guessLocked = true;
  clearInterval(timerInterval);

  // Show guess pin
  const guessPin = document.getElementById('guessPin');
  guessPin.style.left = xPct + '%';
  guessPin.style.top = yPct + '%';
  guessPin.style.display = 'block';

  revealAnswer(xPct, yPct);
}

function revealAnswer(guessX, guessY) {
  const target = currentTarget;
  const answerPin = document.getElementById('answerPin');

  // Show answer pin
  answerPin.style.left = target.x + '%';
  answerPin.style.top = target.y + '%';
  answerPin.style.display = 'block';

  let pts = 0;
  let dist = 0;

  if (guessX !== null) {
    dist = Math.hypot(guessX - target.x, guessY - target.y);
    pts = calcScore(dist);

    // Draw distance line
    const line = document.getElementById('distanceLine');
    line.setAttribute('x1', guessX);
    line.setAttribute('y1', guessY);
    line.setAttribute('x2', target.x);
    line.setAttribute('y2', target.y);
    line.setAttribute('opacity', '0.85');
    line.setAttribute('stroke', pts >= 700 ? 'var(--green)' : 'var(--red)');
  }

  // Streak
  if (pts >= 400) {
    currentStreak++;
    if (currentStreak >= 3) pts = Math.round(pts * 1.1); // 10% streak bonus
  } else {
    currentStreak = 0;
  }

  totalScore += pts;
  roundResults.push({ name: target.name, pts, dist, guessX, guessY });
  updateStats();

  // Result overlay
  const sl = scoreLabel(pts);
  const overlay = document.getElementById('resultOverlay');
  const badge = document.getElementById('resultBadge');
  document.getElementById('resultName').textContent = target.name;

  if (guessX === null) {
    document.getElementById('resultDetail').textContent = `â±ï¸ Time's up! It was ${target.region || target.continent || ''}`;
  } else {
    document.getElementById('resultDetail').textContent = `${distanceDisplay(dist)} Â· ${target.region || target.continent || ''}${currentStreak >= 3 ? ' ğŸ”¥ Streak bonus!' : ''}`;
  }

  badge.textContent = `${sl.label} ${pts > 0 ? pts.toLocaleString() + ' pts' : ''}`;
  badge.className = `result-score-badge ${sl.cls}`;
  overlay.classList.add('show');

  const nextBtn = document.getElementById('nextBtn');
  nextBtn.textContent = currentRound < totalRounds - 1 ? 'Next â†’' : 'See Results!';
}

function nextQuestion() {
  currentRound++;
  if (currentRound >= totalRounds) {
    showEndScreen();
  } else {
    loadQuestion();
  }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// HINTS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function useHint(n) {
  if (guessLocked) return;
  if (hintsUsed.includes(n)) return;
  hintsUsed.push(n);
  const btn = document.getElementById(`hintBtn${n}`);
  btn.classList.add('used');
  btn.disabled = true;

  const t = currentTarget;
  let hint = '';
  if (n === 1) {
    hint = `ğŸ“ Region: ${t.region || t.continent || 'Unknown'}`;
  } else if (n === 2) {
    hint = `ğŸ”¤ Starts with: "${t.name[0]}"`;
    if (t.fact) hint += ` Â· ${t.fact}`;
  }

  document.getElementById('hintText').textContent = hint;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// END SCREEN
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showEndScreen() {
  clearInterval(timerInterval);
  showScreen('endScreen');

  const maxPts = totalRounds * 1000;
  const pct = totalScore / maxPts;

  let trophy = 'ğŸ†', title = 'Great Explorer!';
  if (pct >= 0.9)       { trophy = 'ğŸ¥‡'; title = 'Geography Master!'; }
  else if (pct >= 0.75) { trophy = 'ğŸ†'; title = 'Great Explorer!'; }
  else if (pct >= 0.5)  { trophy = 'ğŸ¥ˆ'; title = 'Getting There!'; }
  else if (pct >= 0.25) { trophy = 'ğŸ¥‰'; title = 'Keep Exploring!'; }
  else                  { trophy = 'ğŸ—ºï¸'; title = 'Time to Study!'; }

  document.getElementById('endTrophy').textContent = trophy;
  document.getElementById('endTitle').textContent = title;
  document.getElementById('endFinalScore').textContent = totalScore.toLocaleString() + ' pts';

  const rankLabels = [
    { min: 0.9, label: 'ğŸŒŸ World-class navigator' },
    { min: 0.75, label: 'âœˆï¸ Seasoned traveler' },
    { min: 0.5, label: 'ğŸ§­ Curious explorer' },
    { min: 0.25, label: 'ğŸ—ºï¸ Rookie cartographer' },
    { min: 0, label: 'ğŸ“š Keep studying!' },
  ];
  const rank = rankLabels.find(r => pct >= r.min);
  document.getElementById('endRank').textContent = rank.label;

  // Build breakdown
  const rows = document.getElementById('breakdownRows');
  rows.innerHTML = '';
  roundResults.forEach((r, i) => {
    const sl = scoreLabel(r.pts);
    const row = document.createElement('div');
    row.className = 'breakdown-row';
    row.style.animationDelay = (i * 0.07) + 's';
    row.innerHTML = `
      <span class="breakdown-name">${i+1}. ${r.name}</span>
      <span class="breakdown-dist">${r.guessX !== null ? distanceDisplay(r.dist) : "Time's up"}</span>
      <span class="breakdown-pts pts-${sl.cls}">${r.pts.toLocaleString()}</span>
    `;
    rows.appendChild(row);
  });

  if (pct >= 0.75) launchConfetti();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CONFETTI
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function launchConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  const ctx = canvas.getContext('2d');
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  const colors = ['#f7c948','#5cbb6f','#4a90d9','#e8453c','#9b6fda','#f5832a','#e8668a','#3dbfb0'];
  const pieces = Array.from({length: 120}, () => ({
    x: Math.random() * canvas.width,
    y: Math.random() * -canvas.height,
    r: 4 + Math.random() * 6,
    color: colors[Math.floor(Math.random() * colors.length)],
    vx: (Math.random() - 0.5) * 3,
    vy: 2 + Math.random() * 4,
    rot: Math.random() * 360,
    rotV: (Math.random() - 0.5) * 8,
    shape: Math.random() > 0.5 ? 'rect' : 'circle'
  }));

  let frame = 0;
  function draw() {
    if (frame > 200) { ctx.clearRect(0,0,canvas.width,canvas.height); return; }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p => {
      ctx.save();
      ctx.translate(p.x, p.y);
      ctx.rotate(p.rot * Math.PI / 180);
      ctx.fillStyle = p.color;
      ctx.globalAlpha = Math.max(0, 1 - frame / 180);
      if (p.shape === 'circle') {
        ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill();
      } else {
        ctx.fillRect(-p.r, -p.r/2, p.r*2, p.r);
      }
      ctx.restore();
      p.x += p.vx; p.y += p.vy; p.rot += p.rotV; p.vy += 0.05;
    });
    frame++;
    requestAnimationFrame(draw);
  }
  draw();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// UTILITIES
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

// Touch support for iPad map clicking
document.addEventListener('DOMContentLoaded', () => {
  const mapWrap = document.getElementById('mapWrap');
  mapWrap.addEventListener('touchend', (e) => {
    e.preventDefault();
    if (guessLocked) return;
    const touch = e.changedTouches[0];
    const rect = mapWrap.getBoundingClientRect();
    const xPct = ((touch.clientX - rect.left) / rect.width) * 100;
    const yPct = ((touch.clientY - rect.top) / rect.height) * 100;
    placeGuess(xPct, yPct);
  }, { passive: false });
});
</script>
</body>
</html>
