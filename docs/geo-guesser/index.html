<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>üåç Geo Guesser ‚Äî Galaxy Dashboard</title>
<link rel="icon" href="../favicon.svg" type="image/svg+xml">
<link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root {
  --beige: #f5ead6;
  --beige-dark: #ecdcc0;
  --beige-darker: #e0c99a;
  --cream: #fdf6e8;
  --ink: #3b2f1e;
  --ink-light: #7a5c3a;
  --red: #e8453c;
  --orange: #f5832a;
  --yellow: #f7c948;
  --teal: #3dbfb0;
  --blue: #4a90d9;
  --purple: #9b6fda;
  --green: #5cbb6f;
  --pink: #e8668a;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--beige);
  font-family: 'Nunito', sans-serif;
  min-height: 100vh;
  overflow-x: hidden;
  color: var(--ink);
}

/* ‚îÄ‚îÄ BAR 1: TOP NAV (clean ‚Äî like other pages) ‚îÄ‚îÄ */
.topbar {
  display: flex;
  align-items: center;
  gap: 0.6rem;
  padding: 0.7rem 1.2rem;
  background: var(--cream);
  border-bottom: 3px solid var(--ink);
  position: sticky;
  top: 0;
  z-index: 1100;
}

.back-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 0.95rem;
  color: var(--ink);
  text-decoration: none;
  background: var(--beige);
  border: 2.5px solid var(--ink);
  border-radius: 12px;
  padding: 0.3rem 0.75rem;
  transition: background 0.15s;
  white-space: nowrap;
}
.back-btn:hover { background: var(--beige-darker); }

.game-title {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(1.1rem, 3vw, 1.6rem);
  color: var(--ink);
}

/* ‚îÄ‚îÄ BAR 2: STATS (centered ‚≠ê round üî•, in-game only) ‚îÄ‚îÄ */
.stats-bar {
  display: flex;
  gap: 0.6rem;
  padding: 0.45rem 1rem;
  align-items: center;
  justify-content: center;
  background: var(--beige);
  border-bottom: 2px solid var(--beige-darker);
  position: relative;
  z-index: 1050;
}

.stat-chip {
  font-family: 'Fredoka One', cursive;
  font-size: 0.9rem;
  padding: 0.25rem 0.7rem;
  border-radius: 20px;
  border: 2px solid var(--ink);
  white-space: nowrap;
}
.stat-chip.score-chip  { background: #fef3c2; }
.stat-chip.round-chip  { background: #dbeeff; }
.stat-chip.streak-chip { background: #fde0ea; }

/* ‚îÄ‚îÄ BAR 3: QUESTION + TIMER ‚îÄ‚îÄ */
.question-bar {
  background: var(--cream);
  border-bottom: 3px solid var(--beige-darker);
  padding: 0.7rem 1.2rem;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 0.8rem;
  flex-wrap: wrap;
  position: relative;
  z-index: 1050;
}

.question-text {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(1.05rem, 3.5vw, 1.5rem);
  color: var(--ink);
  flex: 1;
}
.question-text span { color: var(--blue); }

.timer-bar-wrap {
  width: 120px;
  height: 12px;
  background: var(--beige-dark);
  border-radius: 10px;
  border: 2px solid var(--ink);
  overflow: hidden;
  flex-shrink: 0;
}
.timer-bar-fill {
  height: 100%;
  background: var(--green);
  border-radius: 8px;
  transition: width 1s linear, background 0.5s;
  width: 100%;
}
.timer-bar-fill.warn   { background: var(--orange); }
.timer-bar-fill.danger { background: var(--red); }

/* ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ */
.screen {
  display: none;
  min-height: calc(100vh - 58px);
}
.screen.active { display: flex; flex-direction: column; }

/* ‚îÄ‚îÄ START SCREEN ‚îÄ‚îÄ */
#startScreen {
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem;
  text-align: center;
}

.start-globe {
  font-size: 5rem;
  animation: globeSpin 4s ease-in-out infinite;
  filter: drop-shadow(0 8px 16px rgba(0,0,0,0.12));
  margin-bottom: 0.5rem;
}
@keyframes globeSpin {
  0%, 100% { transform: rotate(-8deg) scale(1); }
  50%       { transform: rotate(8deg) scale(1.05); }
}

.start-title {
  font-family: 'Fredoka One', cursive;
  font-size: clamp(2rem, 7vw, 3.2rem);
  color: var(--ink);
  line-height: 1.1;
  margin-bottom: 0.4rem;
}
.start-title span { color: var(--blue); }

.start-sub {
  color: var(--ink-light);
  font-weight: 700;
  font-size: 1rem;
  margin-bottom: 2rem;
}

.mode-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 1rem;
  max-width: 680px;
  width: 100%;
  margin-bottom: 2rem;
}

.mode-card {
  background: var(--cream);
  border: 3px solid var(--ink);
  border-radius: 20px;
  padding: 1.4rem 0.8rem;
  cursor: pointer;
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.18s;
  box-shadow: 4px 4px 0 var(--ink);
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 0.5rem;
  position: relative;
  overflow: hidden;
}
.mode-card:hover {
  transform: translateY(-5px) scale(1.03);
  box-shadow: 4px 4px 0 var(--ink), 0 0 24px 6px var(--glow);
}
.mode-card:active { transform: scale(0.97); }
.mode-card.selected {
  transform: translateY(-4px) scale(1.03);
  box-shadow: 4px 4px 0 var(--ink), 0 0 24px 8px var(--glow);
}
.mode-card.selected::before {
  content: '‚úì';
  position: absolute;
  top: 8px; right: 10px;
  font-family: 'Fredoka One', cursive;
  font-size: 1.1rem;
  color: var(--ink);
}

.mode-card.m-states { --glow: rgba(61,191,176,0.5); background: #d6f5f2; }
.mode-card.m-cities { --glow: rgba(74,144,217,0.5); background: #dbeeff; }
.mode-card.m-world  { --glow: rgba(155,111,218,0.5); background: #ede0ff; }

.mode-emoji { font-size: 2.6rem; }
.mode-label {
  font-family: 'Fredoka One', cursive;
  font-size: 1.05rem;
  color: var(--ink);
}
.mode-desc {
  font-size: 0.75rem;
  color: var(--ink-light);
  font-weight: 700;
  text-align: center;
  line-height: 1.3;
}

.diff-row {
  display: flex;
  gap: 0.6rem;
  margin-bottom: 1.5rem;
  align-items: center;
}
.diff-label {
  font-family: 'Fredoka One', cursive;
  font-size: 0.95rem;
  color: var(--ink-light);
}
.diff-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 0.9rem;
  padding: 0.3rem 0.85rem;
  border-radius: 20px;
  border: 2.5px solid var(--ink);
  background: var(--cream);
  cursor: pointer;
  transition: background 0.15s, transform 0.1s;
}
.diff-btn:hover  { background: var(--beige-darker); }
.diff-btn.active { background: var(--yellow); font-weight: 800; transform: scale(1.05); }

.start-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 1.35rem;
  padding: 0.85rem 3rem;
  background: var(--green);
  color: white;
  border: 3px solid var(--ink);
  border-radius: 50px;
  cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.15s;
}
.start-btn:hover {
  transform: translateY(-3px) scale(1.04);
  box-shadow: 4px 4px 0 var(--ink), 0 0 20px 6px rgba(92,187,111,0.5);
}
.start-btn:active  { transform: scale(0.97); box-shadow: 2px 2px 0 var(--ink); }
.start-btn:disabled {
  background: var(--beige-darker);
  color: var(--ink-light);
  cursor: not-allowed;
  box-shadow: 2px 2px 0 var(--ink);
  transform: none;
}

/* ‚îÄ‚îÄ GAME SCREEN ‚îÄ‚îÄ */
#gameScreen { flex: 1; display: none; flex-direction: column; }
#gameScreen.active { display: flex; }

/* Map wrapper */
.map-wrap {
  flex: 1;
  position: relative;
  overflow: hidden;
  min-height: 320px;
}

#mapContainer {
  position: absolute;
  inset: 0;
  z-index: 1;
}

.leaflet-container { cursor: crosshair !important; font-family: 'Nunito', sans-serif; }
.leaflet-grab      { cursor: crosshair !important; }
.leaflet-dragging .leaflet-container { cursor: grabbing !important; }

/* Result overlay */
.result-overlay {
  position: absolute;
  bottom: 0; left: 0; right: 0;
  background: rgba(253,246,232,0.97);
  border-top: 3px solid var(--ink);
  padding: 1rem 1.4rem;
  display: none;
  align-items: center;
  justify-content: space-between;
  gap: 1rem;
  z-index: 1000;
  flex-wrap: wrap;
}
.result-overlay.show { display: flex; }

.result-info { flex: 1; min-width: 0; }
.result-name {
  font-family: 'Fredoka One', cursive;
  font-size: 1.3rem;
  color: var(--ink);
  margin-bottom: 0.2rem;
}
.result-detail {
  font-size: 0.85rem;
  color: var(--ink-light);
  font-weight: 700;
}

.result-score-badge {
  font-family: 'Fredoka One', cursive;
  font-size: 1.9rem;
  padding: 0.4rem 1.1rem;
  border-radius: 20px;
  border: 3px solid var(--ink);
  background: var(--yellow);
  white-space: nowrap;
  animation: popIn 0.35s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes popIn {
  from { transform: scale(0.4); opacity: 0; }
  to   { transform: scale(1);   opacity: 1; }
}
.result-score-badge.perfect { background: #a8f0b0; }
.result-score-badge.great   { background: var(--yellow); }
.result-score-badge.ok      { background: #ffd4a0; }
.result-score-badge.poor    { background: #ffc0c0; }

.next-btn {
  font-family: 'Fredoka One', cursive;
  font-size: 1.1rem;
  padding: 0.6rem 1.6rem;
  background: var(--blue);
  color: white;
  border: 3px solid var(--ink);
  border-radius: 40px;
  cursor: pointer;
  box-shadow: 3px 3px 0 var(--ink);
  transition: transform 0.15s, box-shadow 0.15s;
  white-space: nowrap;
}
.next-btn:hover  { transform: translateY(-2px); box-shadow: 3px 3px 0 var(--ink), 0 0 14px rgba(74,144,217,0.5); }
.next-btn:active { transform: scale(0.97); }

/* Progress dots ‚Äî inline in question bar */
.progress-dots {
  display: flex;
  gap: 5px;
  align-items: center;
  flex-shrink: 0;
}
.progress-dot {
  width: 10px; height: 10px;
  border-radius: 50%;
  border: 2px solid var(--ink);
  background: var(--cream);
  transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
}
/* Score-based colors */
.progress-dot.dot-perfect {
  background: var(--green);
  border-color: var(--green);
  transform: scale(1.25);
  box-shadow: 0 0 8px 4px rgba(92,187,111,0.7), 0 0 16px 6px rgba(92,187,111,0.3);
  animation: perfectPop 0.4s cubic-bezier(.34,1.56,.64,1) both;
}
@keyframes perfectPop {
  from { transform: scale(0.5); box-shadow: none; }
  to   { transform: scale(1.25); box-shadow: 0 0 8px 4px rgba(92,187,111,0.7); }
}
.progress-dot.dot-great { background: var(--green);  border-color: var(--green);  transform: scale(1.15); }
.progress-dot.dot-ok    { background: var(--yellow); border-color: var(--yellow); transform: scale(1.1); }
.progress-dot.dot-poor  { background: var(--red);    border-color: var(--red);    transform: scale(1.1); }
/* Current round ‚Äî blue pulse */
.progress-dot.dot-current {
  background: var(--blue);
  border-color: var(--blue);
  transform: scale(1.3);
  animation: dotPulse 1s ease infinite;
}
@keyframes dotPulse {
  0%, 100% { box-shadow: 0 0 0 0 rgba(74,144,217,0.7); }
  50%       { box-shadow: 0 0 0 6px rgba(74,144,217,0); }
}

/* ‚îÄ‚îÄ END SCREEN ‚îÄ‚îÄ */
#endScreen {
  align-items: center;
  justify-content: center;
  padding: 2rem 1.5rem;
  text-align: center;
}

.end-trophy {
  font-size: 5rem;
  animation: trophyBounce 1s cubic-bezier(.34,1.56,.64,1) both;
  margin-bottom: 0.5rem;
}
@keyframes trophyBounce {
  from { transform: scale(0.3) translateY(40px); opacity: 0; }
  to   { transform: scale(1) translateY(0); opacity: 1; }
}
.end-title      { font-family: 'Fredoka One', cursive; font-size: clamp(1.8rem, 6vw, 2.8rem); color: var(--ink); margin-bottom: 0.3rem; }
.end-final-score{ font-family: 'Fredoka One', cursive; font-size: clamp(2.5rem, 9vw, 4rem); color: var(--blue); margin-bottom: 0.3rem; }
.end-rank       { font-size: 1rem; color: var(--ink-light); font-weight: 700; margin-bottom: 1.5rem; }

.score-breakdown {
  width: 100%; max-width: 500px;
  background: var(--cream);
  border: 3px solid var(--ink);
  border-radius: 20px;
  overflow: hidden;
  margin-bottom: 1.5rem;
  box-shadow: 4px 4px 0 var(--ink);
}
.breakdown-header {
  background: var(--ink); color: var(--cream);
  font-family: 'Fredoka One', cursive; font-size: 0.95rem;
  padding: 0.5rem 1rem; text-align: left;
}
.breakdown-row {
  display: flex; align-items: center; justify-content: space-between;
  padding: 0.45rem 1rem;
  border-bottom: 1.5px solid var(--beige-dark);
  gap: 0.5rem;
  animation: slideIn 0.3s ease both;
}
.breakdown-row:last-child { border-bottom: none; }
@keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: none; } }
.breakdown-name  { font-weight: 700; font-size: 0.85rem; flex: 1; text-align: left; }
.breakdown-dist  { font-size: 0.78rem; color: var(--ink-light); font-weight: 700; text-align: right; }
.breakdown-pts   { font-family: 'Fredoka One', cursive; font-size: 1rem; min-width: 55px; text-align: right; padding: 0.1rem 0.5rem; border-radius: 12px; }
.breakdown-pts.pts-perfect { background: #a8f0b0; }
.breakdown-pts.pts-great   { background: #fef3c2; }
.breakdown-pts.pts-ok      { background: #ffd4a0; }
.breakdown-pts.pts-poor    { background: #ffc0c0; }

.end-actions { display: flex; gap: 0.75rem; flex-wrap: wrap; justify-content: center; }
.btn-primary {
  font-family: 'Fredoka One', cursive; font-size: 1.15rem;
  padding: 0.7rem 2rem; background: var(--green); color: white;
  border: 3px solid var(--ink); border-radius: 40px; cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1), box-shadow 0.15s;
}
.btn-primary:hover { transform: translateY(-3px) scale(1.04); box-shadow: 4px 4px 0 var(--ink), 0 0 18px rgba(92,187,111,0.5); }
.btn-secondary {
  font-family: 'Fredoka One', cursive; font-size: 1.15rem;
  padding: 0.7rem 2rem; background: var(--cream); color: var(--ink);
  border: 3px solid var(--ink); border-radius: 40px; cursor: pointer;
  box-shadow: 4px 4px 0 var(--ink);
  transition: transform 0.18s cubic-bezier(.34,1.56,.64,1);
}
.btn-secondary:hover { transform: translateY(-3px) scale(1.04); background: var(--beige-darker); }

#confettiCanvas { position: fixed; inset: 0; pointer-events: none; z-index: 9999; }

@media (max-width: 600px) {
  .mode-grid { grid-template-columns: 1fr; max-width: 280px; }
  .question-bar { padding: 0.5rem 0.8rem; }
  .result-overlay { flex-direction: column; align-items: flex-start; }
  .timer-bar-wrap { width: 80px; }
}
@media (max-width: 768px) {
  .mode-grid { grid-template-columns: repeat(3, 1fr); }
}
</style>
</head>
<body>

<canvas id="confettiCanvas"></canvas>

<!-- ‚ïê‚ïê‚ïê BAR 1: CLEAN TOP NAV ‚ïê‚ïê‚ïê -->
<div class="topbar">
  <a href="../" class="back-btn">‚Üê Home</a>
  <div class="game-title">üåç Geo Guesser</div>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê START SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="startScreen" class="screen active">
  <div class="start-globe">üåç</div>
  <h1 class="start-title">Geo <span>Guesser</span></h1>
  <p class="start-sub">Click the map to place where you think it is!</p>

  <div class="mode-grid">
    <div class="mode-card m-states" data-mode="states" onclick="selectMode('states')">
      <div class="mode-emoji">üó∫Ô∏è</div>
      <div class="mode-label">US States</div>
      <div class="mode-desc">50 states on the US map</div>
    </div>
    <div class="mode-card m-cities" data-mode="cities" onclick="selectMode('cities')">
      <div class="mode-emoji">üèôÔ∏è</div>
      <div class="mode-label">US Cities</div>
      <div class="mode-desc">Major American cities</div>
    </div>
    <div class="mode-card m-world" data-mode="world" onclick="selectMode('world')">
      <div class="mode-emoji">üåê</div>
      <div class="mode-label">Countries</div>
      <div class="mode-desc">Nations of the world</div>
    </div>
  </div>

  <div class="diff-row">
    <span class="diff-label">Rounds:</span>
    <button class="diff-btn active" onclick="setRounds(5,this)">5</button>
    <button class="diff-btn" onclick="setRounds(10,this)">10</button>
    <button class="diff-btn" onclick="setRounds(15,this)">15</button>
  </div>

  <button class="start-btn" id="startBtn" onclick="startGame()" disabled>Choose a mode to start!</button>
</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GAME SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="gameScreen" class="screen">

  <!-- BAR 2: STATS ‚Äî centered ‚≠ê round üî• -->
  <div class="stats-bar">
    <div class="stat-chip score-chip">‚≠ê <span id="statScore">0</span></div>
    <div class="stat-chip round-chip">Round <span id="statRound">1</span> / <span id="statTotal">5</span></div>
    <div class="stat-chip streak-chip">üî• <span id="statStreak">0</span></div>
  </div>

  <!-- BAR 3: QUESTION + PROGRESS DOTS + TIMER -->
  <div class="question-bar">
    <div class="question-text">Where is <span id="targetName">‚Ä¶</span>?</div>
    <div class="progress-dots" id="progressDots"></div>
    <div class="timer-bar-wrap" title="Time remaining">
      <div class="timer-bar-fill" id="timerBar"></div>
    </div>
  </div>

  <!-- Map -->
  <div class="map-wrap" id="mapWrap">
    <div id="mapContainer"></div>

    <div class="result-overlay" id="resultOverlay">
      <div class="result-info">
        <div class="result-name" id="resultName"></div>
        <div class="result-detail" id="resultDetail"></div>
      </div>
      <div class="result-score-badge" id="resultBadge"></div>
      <button class="next-btn" id="nextBtn" onclick="nextQuestion(event)">Next ‚Üí</button>
    </div>
  </div>

</div>

<!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê END SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
<div id="endScreen" class="screen">
  <div class="end-trophy" id="endTrophy">üèÜ</div>
  <div class="end-title" id="endTitle">Great Explorer!</div>
  <div class="end-final-score" id="endFinalScore">0 pts</div>
  <div class="end-rank" id="endRank"></div>

  <div class="score-breakdown" id="scoreBreakdown">
    <div class="breakdown-header">üìã Round by Round</div>
    <div id="breakdownRows"></div>
  </div>

  <div class="end-actions">
    <button class="btn-primary" onclick="startGame()">Play Again</button>
    <button class="btn-secondary" onclick="showStart()">Change Mode</button>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA ‚Äî r = approximate boundary radius in km
// If your click lands within r km of the centroid, you get full marks.
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

const US_STATES = [
  { name:"Alabama",        lat:32.8,  lng:-86.8,  region:"Southeast",      r:160 },
  { name:"Alaska",         lat:64.2,  lng:-153.0, region:"Far West",        r:700 },
  { name:"Arizona",        lat:34.3,  lng:-111.1, region:"Southwest",       r:250 },
  { name:"Arkansas",       lat:34.9,  lng:-92.4,  region:"South Central",   r:160 },
  { name:"California",     lat:36.8,  lng:-119.4, region:"West Coast",      r:320 },
  { name:"Colorado",       lat:39.0,  lng:-105.5, region:"Mountain West",   r:220 },
  { name:"Connecticut",    lat:41.6,  lng:-72.7,  region:"New England",     r:55  },
  { name:"Delaware",       lat:39.0,  lng:-75.5,  region:"Mid-Atlantic",    r:40  },
  { name:"Florida",        lat:27.8,  lng:-81.6,  region:"Southeast",       r:230 },
  { name:"Georgia",        lat:32.7,  lng:-83.2,  region:"Southeast",       r:175 },
  { name:"Hawaii",         lat:20.9,  lng:-157.0, region:"Pacific",         r:110 },
  { name:"Idaho",          lat:44.4,  lng:-114.6, region:"Northwest",       r:250 },
  { name:"Illinois",       lat:40.0,  lng:-89.2,  region:"Midwest",         r:190 },
  { name:"Indiana",        lat:39.8,  lng:-86.1,  region:"Midwest",         r:140 },
  { name:"Iowa",           lat:42.1,  lng:-93.5,  region:"Midwest",         r:190 },
  { name:"Kansas",         lat:38.5,  lng:-98.4,  region:"Great Plains",    r:220 },
  { name:"Kentucky",       lat:37.5,  lng:-85.3,  region:"Southeast",       r:190 },
  { name:"Louisiana",      lat:31.2,  lng:-91.8,  region:"South",           r:175 },
  { name:"Maine",          lat:45.4,  lng:-69.0,  region:"New England",     r:200 },
  { name:"Maryland",       lat:39.0,  lng:-76.8,  region:"Mid-Atlantic",    r:110 },
  { name:"Massachusetts",  lat:42.3,  lng:-71.8,  region:"New England",     r:110 },
  { name:"Michigan",       lat:44.2,  lng:-85.4,  region:"Great Lakes",     r:230 },
  { name:"Minnesota",      lat:46.4,  lng:-93.1,  region:"Upper Midwest",   r:250 },
  { name:"Mississippi",    lat:32.7,  lng:-89.7,  region:"South",           r:160 },
  { name:"Missouri",       lat:38.5,  lng:-92.5,  region:"Midwest",         r:190 },
  { name:"Montana",        lat:47.0,  lng:-109.6, region:"Mountain West",   r:330 },
  { name:"Nebraska",       lat:41.5,  lng:-99.9,  region:"Great Plains",    r:230 },
  { name:"Nevada",         lat:39.3,  lng:-116.6, region:"West",            r:270 },
  { name:"New Hampshire",  lat:43.7,  lng:-71.6,  region:"New England",     r:100 },
  { name:"New Jersey",     lat:40.1,  lng:-74.4,  region:"Mid-Atlantic",    r:80  },
  { name:"New Mexico",     lat:34.5,  lng:-106.0, region:"Southwest",       r:270 },
  { name:"New York",       lat:42.2,  lng:-74.8,  region:"Mid-Atlantic",    r:210 },
  { name:"North Carolina", lat:35.6,  lng:-79.8,  region:"Southeast",       r:220 },
  { name:"North Dakota",   lat:47.5,  lng:-100.5, region:"Great Plains",    r:220 },
  { name:"Ohio",           lat:40.4,  lng:-82.8,  region:"Midwest",         r:165 },
  { name:"Oklahoma",       lat:35.6,  lng:-96.9,  region:"South Central",   r:225 },
  { name:"Oregon",         lat:44.0,  lng:-120.5, region:"Pacific Northwest",r:265 },
  { name:"Pennsylvania",   lat:40.9,  lng:-77.8,  region:"Mid-Atlantic",    r:175 },
  { name:"Rhode Island",   lat:41.7,  lng:-71.5,  region:"New England",     r:35  },
  { name:"South Carolina", lat:33.9,  lng:-80.9,  region:"Southeast",       r:145 },
  { name:"South Dakota",   lat:44.4,  lng:-100.2, region:"Great Plains",    r:230 },
  { name:"Tennessee",      lat:35.9,  lng:-86.4,  region:"Southeast",       r:220 },
  { name:"Texas",          lat:31.1,  lng:-97.6,  region:"South Central",   r:440 },
  { name:"Utah",           lat:39.3,  lng:-111.1, region:"Mountain West",   r:225 },
  { name:"Vermont",        lat:44.0,  lng:-72.7,  region:"New England",     r:100 },
  { name:"Virginia",       lat:37.9,  lng:-78.7,  region:"Mid-Atlantic",    r:190 },
  { name:"Washington",     lat:47.4,  lng:-120.5, region:"Pacific Northwest",r:220 },
  { name:"West Virginia",  lat:38.7,  lng:-80.6,  region:"Mid-Atlantic",    r:135 },
  { name:"Wisconsin",      lat:44.3,  lng:-89.8,  region:"Midwest",         r:220 },
  { name:"Wyoming",        lat:43.0,  lng:-107.6, region:"Mountain West",   r:270 },
];

const US_CITIES = [
  { name:"New York City, NY",   lat:40.71, lng:-74.00,  region:"Northeast",        r:40, fact:"Most populous US city" },
  { name:"Los Angeles, CA",     lat:34.05, lng:-118.24, region:"West Coast",        r:40, fact:"2nd most populous city" },
  { name:"Chicago, IL",         lat:41.88, lng:-87.63,  region:"Midwest",           r:40, fact:"The Windy City" },
  { name:"Houston, TX",         lat:29.76, lng:-95.37,  region:"South Texas",       r:40, fact:"Space City" },
  { name:"Phoenix, AZ",         lat:33.45, lng:-112.07, region:"Southwest",         r:40, fact:"Valley of the Sun" },
  { name:"Philadelphia, PA",    lat:39.95, lng:-75.17,  region:"Mid-Atlantic",      r:40, fact:"City of Brotherly Love" },
  { name:"San Antonio, TX",     lat:29.42, lng:-98.49,  region:"South Texas",       r:40, fact:"Near the Alamo" },
  { name:"San Diego, CA",       lat:32.72, lng:-117.16, region:"West Coast",        r:40, fact:"America's Finest City" },
  { name:"Dallas, TX",          lat:32.78, lng:-96.80,  region:"South Central",     r:40, fact:"Big D" },
  { name:"San Jose, CA",        lat:37.34, lng:-121.89, region:"West Coast",        r:40, fact:"Silicon Valley hub" },
  { name:"Austin, TX",          lat:30.27, lng:-97.74,  region:"South Central",     r:40, fact:"Keep Austin Weird!" },
  { name:"Jacksonville, FL",    lat:30.33, lng:-81.66,  region:"Southeast",         r:40, fact:"Largest city by area" },
  { name:"Fort Worth, TX",      lat:32.72, lng:-97.32,  region:"South Central",     r:40, fact:"Cowtown" },
  { name:"Columbus, OH",        lat:39.96, lng:-82.99,  region:"Midwest",           r:40, fact:"Ohio capital" },
  { name:"Charlotte, NC",       lat:35.23, lng:-80.84,  region:"Southeast",         r:40, fact:"Queen City" },
  { name:"Indianapolis, IN",    lat:39.77, lng:-86.16,  region:"Midwest",           r:40, fact:"Indy 500!" },
  { name:"San Francisco, CA",   lat:37.77, lng:-122.42, region:"West Coast",        r:40, fact:"The Golden Gate city" },
  { name:"Seattle, WA",         lat:47.61, lng:-122.33, region:"Pacific Northwest", r:40, fact:"Emerald City" },
  { name:"Denver, CO",          lat:39.74, lng:-104.98, region:"Mountain West",     r:40, fact:"Mile High City" },
  { name:"Nashville, TN",       lat:36.17, lng:-86.78,  region:"Southeast",         r:40, fact:"Music City" },
  { name:"Oklahoma City, OK",   lat:35.47, lng:-97.52,  region:"South Central",     r:40, fact:"OKC" },
  { name:"El Paso, TX",         lat:31.76, lng:-106.49, region:"Southwest",         r:40, fact:"Sun City" },
  { name:"Boston, MA",          lat:42.36, lng:-71.06,  region:"New England",       r:40, fact:"Cradle of Liberty" },
  { name:"Portland, OR",        lat:45.52, lng:-122.68, region:"Pacific Northwest", r:40, fact:"City of Roses" },
  { name:"Las Vegas, NV",       lat:36.17, lng:-115.14, region:"Southwest",         r:40, fact:"Entertainment capital" },
  { name:"Memphis, TN",         lat:35.15, lng:-90.05,  region:"Southeast",         r:40, fact:"Home of the Blues" },
  { name:"Atlanta, GA",         lat:33.75, lng:-84.39,  region:"Southeast",         r:40, fact:"The ATL" },
  { name:"Miami, FL",           lat:25.77, lng:-80.19,  region:"Southeast",         r:40, fact:"Magic City" },
  { name:"Minneapolis, MN",     lat:44.98, lng:-93.27,  region:"Midwest",           r:40, fact:"City of Lakes" },
  { name:"New Orleans, LA",     lat:29.95, lng:-90.07,  region:"South",             r:40, fact:"The Big Easy" },
  { name:"Washington, DC",      lat:38.90, lng:-77.04,  region:"Mid-Atlantic",      r:40, fact:"Nation's capital" },
  { name:"Detroit, MI",         lat:42.33, lng:-83.05,  region:"Midwest",           r:40, fact:"Motor City" },
  { name:"Baltimore, MD",       lat:39.29, lng:-76.61,  region:"Mid-Atlantic",      r:40, fact:"Charm City" },
  { name:"Louisville, KY",      lat:38.25, lng:-85.76,  region:"Southeast",         r:40, fact:"Home of the Kentucky Derby" },
  { name:"Milwaukee, WI",       lat:43.04, lng:-87.91,  region:"Midwest",           r:40, fact:"Brew City" },
  { name:"Albuquerque, NM",     lat:35.08, lng:-106.65, region:"Southwest",         r:40, fact:"Hot air balloon capital" },
  { name:"Tucson, AZ",          lat:32.22, lng:-110.93, region:"Southwest",         r:40, fact:"Surrounded by multiple mountain ranges" },
  { name:"Fresno, CA",          lat:36.75, lng:-119.77, region:"West Coast",        r:40, fact:"Agricultural hub of Central Valley" },
  { name:"Sacramento, CA",      lat:38.58, lng:-121.49, region:"West Coast",        r:40, fact:"City of Trees" },
  { name:"Kansas City, MO",     lat:39.10, lng:-94.58,  region:"Midwest",           r:40, fact:"City of Fountains" },
  { name:"Mesa, AZ",            lat:33.42, lng:-111.83, region:"Southwest",         r:40, fact:"Largest suburban city in the US" },
  { name:"Omaha, NE",           lat:41.25, lng:-95.93,  region:"Midwest",           r:40, fact:"Gateway to the West" },
  { name:"Raleigh, NC",         lat:35.78, lng:-78.64,  region:"Southeast",         r:40, fact:"City of Oaks" },
  { name:"Colorado Springs, CO",lat:38.83, lng:-104.82, region:"Mountain West",     r:40, fact:"Home to Pikes Peak" },
  { name:"Long Beach, CA",      lat:33.77, lng:-118.19, region:"West Coast",        r:40, fact:"The Aquatic Capital of America" },
  { name:"Virginia Beach, VA",  lat:36.85, lng:-75.98,  region:"Mid-Atlantic",      r:40, fact:"Where the Chesapeake meets the Atlantic" },
  { name:"Oakland, CA",         lat:37.80, lng:-122.27, region:"West Coast",        r:40, fact:"The Town" },
  { name:"Tulsa, OK",           lat:36.15, lng:-95.99,  region:"South Central",     r:40, fact:"Former Oil Capital of the World" },
  { name:"Tampa, FL",           lat:27.95, lng:-82.46,  region:"Southeast",         r:40, fact:"Cigar City" },
  { name:"Honolulu, HI",        lat:21.31, lng:-157.86, region:"Pacific",           r:40, fact:"The Big Pineapple" },
  { name:"Wichita, KS",         lat:37.69, lng:-97.34,  region:"Midwest",           r:40, fact:"Air Capital of the World" },
  { name:"St. Louis, MO",       lat:38.63, lng:-90.20,  region:"Midwest",           r:40, fact:"Home of the Gateway Arch" },
  { name:"Pittsburgh, PA",      lat:40.44, lng:-79.99,  region:"Mid-Atlantic",      r:40, fact:"City of Bridges" },
  { name:"Anchorage, AK",       lat:61.22, lng:-149.90, region:"Alaska",            r:40, fact:"Most populous city in Alaska" },
  { name:"Cincinnati, OH",      lat:39.10, lng:-84.51,  region:"Midwest",           r:40, fact:"The Queen City" },
  { name:"Orlando, FL",         lat:28.54, lng:-81.38,  region:"Southeast",         r:40, fact:"Theme Park Capital of the World" },
  { name:"Buffalo, NY",         lat:42.89, lng:-78.88,  region:"Northeast",         r:40, fact:"The Nickel City" },
  { name:"Madison, WI",         lat:43.07, lng:-89.40,  region:"Midwest",           r:40, fact:"Built on an isthmus" },
  { name:"Reno, NV",            lat:39.53, lng:-119.81, region:"Mountain West",     r:40, fact:"The Biggest Little City in the World" },
  { name:"Baton Rouge, LA",     lat:30.45, lng:-91.14,  region:"South",             r:40, fact:"Red Stick" },
  { name:"Richmond, VA",        lat:37.54, lng:-77.43,  region:"Mid-Atlantic",      r:40, fact:"River City" },
  { name:"Boise, ID",           lat:43.62, lng:-116.20, region:"Mountain West",     r:40, fact:"City of Trees" },
  { name:"Spokane, WA",         lat:47.66, lng:-117.43, region:"Pacific Northwest", r:40, fact:"The Lilac City" },
  { name:"Birmingham, AL",      lat:33.52, lng:-86.81,  region:"Southeast",         r:40, fact:"The Magic City" },
  { name:"Des Moines, IA",      lat:41.59, lng:-93.62,  region:"Midwest",           r:40, fact:"Major center for the US insurance industry" },
  { name:"Rochester, NY",       lat:43.16, lng:-77.61,  region:"Northeast",         r:40, fact:"The Flower City" },
  { name:"Grand Rapids, MI",    lat:42.96, lng:-85.67,  region:"Midwest",           r:40, fact:"Furniture City" },
  { name:"Huntsville, AL",      lat:34.73, lng:-86.59,  region:"Southeast",         r:40, fact:"The Rocket City" },
  { name:"Salt Lake City, UT",  lat:40.76, lng:-111.89, region:"Mountain West",     r:40, fact:"Crossroads of the West" },
  { name:"Little Rock, AR",     lat:34.75, lng:-92.29,  region:"South",             r:40, fact:"Named for a small rock formation on the river" },
  { name:"Tallahassee, FL",     lat:30.44, lng:-84.28,  region:"Southeast",         r:40, fact:"Florida's capital" },
  { name:"Montgomery, AL",      lat:32.38, lng:-86.30,  region:"Southeast",         r:40, fact:"Birthplace of the Civil Rights Movement" },
  { name:"Shreveport, LA",      lat:32.53, lng:-93.75,  region:"South",             r:40, fact:"Cultural center of the Ark-La-Tex region" },
  { name:"Augusta, GA",         lat:33.47, lng:-81.97,  region:"Southeast",         r:40, fact:"Home of The Masters golf tournament" },
  { name:"Mobile, AL",          lat:30.69, lng:-88.04,  region:"Southeast",         r:40, fact:"Birthplace of Mardi Gras in the US" },
  { name:"Fargo, ND",           lat:46.88, lng:-96.79,  region:"Midwest",           r:40, fact:"Gateway to the West" },
  { name:"Sioux Falls, SD",     lat:43.55, lng:-96.73,  region:"Midwest",           r:40, fact:"Named for the cascades on the Big Sioux River" },
  { name:"Billings, MT",        lat:45.78, lng:-108.50, region:"Mountain West",     r:40, fact:"The Magic City" },
  { name:"Cheyenne, WY",        lat:41.14, lng:-104.82, region:"Mountain West",     r:40, fact:"Capital of Wyoming" },
  { name:"Providence, RI",      lat:41.82, lng:-71.41,  region:"New England",       r:40, fact:"The Creative Capital" },
  { name:"Manchester, NH",      lat:42.99, lng:-71.45,  region:"New England",       r:40, fact:"Queen City" },
  { name:"Portland, ME",        lat:43.66, lng:-70.25,  region:"New England",       r:40, fact:"The Forest City" },
  { name:"Burlington, VT",      lat:44.48, lng:-73.21,  region:"New England",       r:40, fact:"First US city to run entirely on renewable energy" },
  { name:"Hartford, CT",        lat:41.76, lng:-72.67,  region:"New England",       r:40, fact:"Insurance Capital of the World" },
  { name:"Charleston, SC",      lat:32.78, lng:-79.93,  region:"Southeast",         r:40, fact:"The Holy City" },
  { name:"Savannah, GA",        lat:32.08, lng:-81.09,  region:"Southeast",         r:40, fact:"Hostess City of the South" },
  { name:"Jackson, MS",         lat:32.30, lng:-90.18,  region:"South",             r:40, fact:"City with Soul" },
  { name:"Santa Fe, NM",        lat:35.69, lng:-105.94, region:"Southwest",         r:40, fact:"The City Different" },
  { name:"Boulder, CO",         lat:40.01, lng:-105.27, region:"Mountain West",     r:40, fact:"Nestled at the foothills of the Flatirons" },
  { name:"Ann Arbor, MI",       lat:42.28, lng:-83.74,  region:"Midwest",           r:40, fact:"Tree Town" },
  { name:"Green Bay, WI",       lat:44.52, lng:-88.02,  region:"Midwest",           r:40, fact:"Titletown" },
  { name:"Duluth, MN",          lat:46.78, lng:-92.10,  region:"Midwest",           r:40, fact:"Major port city on Lake Superior" },
  { name:"Lincoln, NE",         lat:40.81, lng:-96.68,  region:"Midwest",           r:40, fact:"Star City" },
  { name:"Topeka, KS",          lat:39.05, lng:-95.69,  region:"Midwest",           r:40, fact:"Top City" },
  { name:"Springfield, IL",     lat:39.80, lng:-89.65,  region:"Midwest",           r:40, fact:"Home of Abraham Lincoln" },
  { name:"Peoria, IL",          lat:40.69, lng:-89.59,  region:"Midwest",           r:40, fact:"River City" },
  { name:"Fort Wayne, IN",      lat:41.08, lng:-85.14,  region:"Midwest",           r:40, fact:"City of Churches" },
  { name:"Evansville, IN",      lat:37.97, lng:-87.57,  region:"Midwest",           r:40, fact:"River City" },
  { name:"Erie, PA",            lat:42.12, lng:-80.08,  region:"Mid-Atlantic",      r:40, fact:"The Flagship City" },
  { name:"Scranton, PA",        lat:41.41, lng:-75.66,  region:"Mid-Atlantic",      r:40, fact:"The Electric City" },
];

const WORLD_COUNTRIES = [
  { name:"Afghanistan",    lat:33,   lng:65,    region:"Asia",          r:380 },
  { name:"Argentina",      lat:-34,  lng:-64,   region:"South America", r:700 },
  { name:"Australia",      lat:-25,  lng:133,   region:"Oceania",       r:1200 },
  { name:"Austria",        lat:47,   lng:14,    region:"Europe",        r:130 },
  { name:"Bangladesh",     lat:24,   lng:90,    region:"Asia",          r:130 },
  { name:"Belgium",        lat:50,   lng:4,     region:"Europe",        r:90  },
  { name:"Bolivia",        lat:-17,  lng:-65,   region:"South America", r:380 },
  { name:"Brazil",         lat:-10,  lng:-55,   region:"South America", r:1200 },
  { name:"Cambodia",       lat:13,   lng:105,   region:"Asia",          r:175 },
  { name:"Canada",         lat:56,   lng:-96,   region:"North America", r:1500 },
  { name:"Chile",          lat:-35,  lng:-71,   region:"South America", r:350 },
  { name:"China",          lat:35,   lng:105,   region:"Asia",          r:1400 },
  { name:"Colombia",       lat:4,    lng:-72,   region:"South America", r:380 },
  { name:"Cuba",           lat:22,   lng:-79,   region:"Caribbean",     r:200 },
  { name:"Czech Republic", lat:50,   lng:15,    region:"Europe",        r:120 },
  { name:"Denmark",        lat:56,   lng:10,    region:"Europe",        r:150 },
  { name:"Ecuador",        lat:-2,   lng:-77,   region:"South America", r:210 },
  { name:"Egypt",          lat:26,   lng:30,    region:"Africa",        r:500 },
  { name:"Ethiopia",       lat:9,    lng:40,    region:"Africa",        r:500 },
  { name:"Finland",        lat:64,   lng:26,    region:"Europe",        r:500 },
  { name:"France",         lat:46,   lng:2,     region:"Europe",        r:320 },
  { name:"Germany",        lat:51,   lng:10,    region:"Europe",        r:280 },
  { name:"Ghana",          lat:8,    lng:-2,    region:"Africa",        r:210 },
  { name:"Greece",         lat:39,   lng:22,    region:"Europe",        r:250 },
  { name:"Guatemala",      lat:15,   lng:-90,   region:"Central America",r:175 },
  { name:"Hungary",        lat:47,   lng:19,    region:"Europe",        r:130 },
  { name:"India",          lat:20,   lng:77,    region:"Asia",          r:900 },
  { name:"Indonesia",      lat:-5,   lng:120,   region:"Asia",          r:700 },
  { name:"Iran",           lat:32,   lng:53,    region:"Asia",          r:600 },
  { name:"Iraq",           lat:33,   lng:44,    region:"Asia",          r:350 },
  { name:"Ireland",        lat:53,   lng:-8,    region:"Europe",        r:190 },
  { name:"Israel",         lat:31,   lng:35,    region:"Asia",          r:80  },
  { name:"Italy",          lat:42,   lng:12,    region:"Europe",        r:380 },
  { name:"Japan",          lat:36,   lng:138,   region:"Asia",          r:350 },
  { name:"Jordan",         lat:31,   lng:36,    region:"Asia",          r:190 },
  { name:"Kazakhstan",     lat:48,   lng:68,    region:"Asia",          r:900 },
  { name:"Kenya",          lat:1,    lng:38,    region:"Africa",        r:380 },
  { name:"Madagascar",     lat:-20,  lng:47,    region:"Africa",        r:430 },
  { name:"Malaysia",       lat:4,    lng:109,   region:"Asia",          r:350 },
  { name:"Mexico",         lat:23,   lng:-102,  region:"North America", r:700 },
  { name:"Morocco",        lat:32,   lng:-5,    region:"Africa",        r:380 },
  { name:"Mozambique",     lat:-18,  lng:35,    region:"Africa",        r:500 },
  { name:"Myanmar",        lat:17,   lng:96,    region:"Asia",          r:380 },
  { name:"Nepal",          lat:28,   lng:84,    region:"Asia",          r:210 },
  { name:"Netherlands",    lat:52,   lng:5,     region:"Europe",        r:100 },
  { name:"New Zealand",    lat:-41,  lng:174,   region:"Oceania",       r:450 },
  { name:"Nigeria",        lat:10,   lng:8,     region:"Africa",        r:450 },
  { name:"North Korea",    lat:40,   lng:127,   region:"Asia",          r:210 },
  { name:"Norway",         lat:64,   lng:10,    region:"Europe",        r:500 },
  { name:"Pakistan",       lat:30,   lng:69,    region:"Asia",          r:550 },
  { name:"Peru",           lat:-10,  lng:-75,   region:"South America", r:550 },
  { name:"Philippines",    lat:13,   lng:122,   region:"Asia",          r:380 },
  { name:"Poland",         lat:52,   lng:20,    region:"Europe",        r:280 },
  { name:"Portugal",       lat:39,   lng:-8,    region:"Europe",        r:200 },
  { name:"Romania",        lat:46,   lng:25,    region:"Europe",        r:240 },
  { name:"Russia",         lat:60,   lng:100,   region:"Europe/Asia",   r:2500 },
  { name:"Saudi Arabia",   lat:24,   lng:45,    region:"Asia",          r:750 },
  { name:"South Africa",   lat:-30,  lng:25,    region:"Africa",        r:750 },
  { name:"South Korea",    lat:36,   lng:128,   region:"Asia",          r:180 },
  { name:"Spain",          lat:40,   lng:-4,    region:"Europe",        r:430 },
  { name:"Sri Lanka",      lat:8,    lng:81,    region:"Asia",          r:130 },
  { name:"Sudan",          lat:15,   lng:30,    region:"Africa",        r:600 },
  { name:"Sweden",         lat:60,   lng:15,    region:"Europe",        r:550 },
  { name:"Switzerland",    lat:47,   lng:8,     region:"Europe",        r:100 },
  { name:"Syria",          lat:35,   lng:38,    region:"Asia",          r:210 },
  { name:"Taiwan",         lat:24,   lng:121,   region:"Asia",          r:120 },
  { name:"Tanzania",       lat:-6,   lng:35,    region:"Africa",        r:430 },
  { name:"Thailand",       lat:15,   lng:101,   region:"Asia",          r:380 },
  { name:"Turkey",         lat:39,   lng:35,    region:"Asia/Europe",   r:500 },
  { name:"Uganda",         lat:1,    lng:32,    region:"Africa",        r:210 },
  { name:"Ukraine",        lat:49,   lng:32,    region:"Europe",        r:430 },
  { name:"United Kingdom", lat:54,   lng:-2,    region:"Europe",        r:380 },
  { name:"United States",  lat:38,   lng:-97,   region:"North America", r:1800 },
  { name:"Uruguay",        lat:-33,  lng:-56,   region:"South America", r:260 },
  { name:"Uzbekistan",     lat:41,   lng:64,    region:"Asia",          r:380 },
  { name:"Venezuela",      lat:8,    lng:-66,   region:"South America", r:430 },
  { name:"Vietnam",        lat:16,   lng:107,   region:"Asia",          r:380 },
  { name:"Yemen",          lat:15,   lng:48,    region:"Asia",          r:380 },
  { name:"Zambia",         lat:-14,  lng:28,    region:"Africa",        r:380 },
  { name:"Zimbabwe",       lat:-20,  lng:30,    region:"Africa",        r:260 },
  { name:"Bhutan",           lat:27,   lng:90,    region:"Asia",            r:120 },
  { name:"Bosnia and Herzegovina", lat:44, lng:18, region:"Europe",         r:130 },
  { name:"Botswana",         lat:-22,  lng:24,    region:"Africa",          r:380 },
  { name:"Bulgaria",         lat:43,   lng:25,    region:"Europe",          r:180 },
  { name:"Burkina Faso",     lat:12,   lng:-1,    region:"Africa",          r:280 },
  { name:"Cameroon",         lat:4,    lng:12,    region:"Africa",          r:320 },
  { name:"Central African Rep.", lat:7, lng:21,   region:"Africa",          r:380 },
  { name:"Chad",             lat:15,   lng:19,    region:"Africa",          r:550 },
  { name:"Costa Rica",       lat:10,   lng:-84,   region:"Central America", r:120 },
  { name:"Croatia",          lat:45,   lng:15,    region:"Europe",          r:150 },
  { name:"Cyprus",           lat:35,   lng:33,    region:"Europe",          r:60  },
  { name:"DR Congo",         lat:-4,   lng:22,    region:"Africa",          r:850 },
  { name:"Dominican Republic",lat:19,  lng:-70,   region:"Caribbean",       r:130 },
  { name:"El Salvador",      lat:14,   lng:-89,   region:"Central America", r:90  },
  { name:"Estonia",          lat:59,   lng:25,    region:"Europe",          r:120 },
  { name:"Fiji",             lat:-18,  lng:178,   region:"Oceania",         r:100 },
  { name:"Gabon",            lat:-1,   lng:12,    region:"Africa",          r:250 },
  { name:"Georgia",          lat:42,   lng:43,    region:"Asia/Europe",     r:130 },
  { name:"Guyana",           lat:5,    lng:-59,   region:"South America",   r:200 },
  { name:"Haiti",            lat:19,   lng:-72,   region:"Caribbean",       r:100 },
  { name:"Honduras",         lat:15,   lng:-86,   region:"Central America", r:180 },
  { name:"Iceland",          lat:65,   lng:-19,   region:"Europe",          r:180 },
  { name:"Ivory Coast",      lat:8,    lng:-5,    region:"Africa",          r:280 },
  { name:"Jamaica",          lat:18,   lng:-77,   region:"Caribbean",       r:90  },
  { name:"Kuwait",           lat:29,   lng:47,    region:"Asia",            r:80  },
  { name:"Kyrgyzstan",       lat:41,   lng:75,    region:"Asia",            r:220 },
  { name:"Laos",             lat:18,   lng:105,   region:"Asia",            r:260 },
  { name:"Latvia",           lat:57,   lng:25,    region:"Europe",          r:130 },
  { name:"Lebanon",          lat:34,   lng:36,    region:"Asia",            r:60  },
  { name:"Libya",            lat:25,   lng:17,    region:"Africa",          r:700 },
  { name:"Lithuania",        lat:55,   lng:24,    region:"Europe",          r:130 },
  { name:"Mali",             lat:17,   lng:-4,    region:"Africa",          r:550 },
  { name:"Mauritania",       lat:21,   lng:-11,   region:"Africa",          r:450 },
  { name:"Moldova",          lat:47,   lng:28,    region:"Europe",          r:100 },
  { name:"Mongolia",         lat:46,   lng:105,   region:"Asia",            r:650 },
  { name:"Namibia",          lat:-22,  lng:17,    region:"Africa",          r:420 },
  { name:"Nicaragua",        lat:13,   lng:-85,   region:"Central America", r:200 },
  { name:"Niger",            lat:16,   lng:8,     region:"Africa",          r:550 },
  { name:"Oman",             lat:21,   lng:56,    region:"Asia",            r:300 },
  { name:"Panama",           lat:9,    lng:-80,   region:"Central America", r:150 },
  { name:"Papua New Guinea", lat:-6,   lng:147,   region:"Oceania",         r:300 },
  { name:"Paraguay",         lat:-23,  lng:-58,   region:"South America",   r:280 },
  { name:"Qatar",            lat:25,   lng:51,    region:"Asia",            r:60  },
  { name:"Rwanda",           lat:-2,   lng:30,    region:"Africa",          r:80  },
  { name:"Senegal",          lat:14,   lng:-14,   region:"Africa",          r:220 },
  { name:"Serbia",           lat:44,   lng:21,    region:"Europe",          r:160 },
  { name:"Singapore",        lat:1,    lng:104,   region:"Asia",            r:30  },
  { name:"Slovakia",         lat:49,   lng:19,    region:"Europe",          r:140 },
  { name:"Slovenia",         lat:46,   lng:15,    region:"Europe",          r:90  },
  { name:"Somalia",          lat:5,    lng:46,    region:"Africa",          r:380 },
  { name:"Suriname",         lat:4,    lng:-56,   region:"South America",   r:180 },
  { name:"Tajikistan",       lat:39,   lng:71,    region:"Asia",            r:190 },
  { name:"Togo",             lat:8,    lng:1,     region:"Africa",          r:110 },
  { name:"Tunisia",          lat:34,   lng:9,     region:"Africa",          r:220 },
  { name:"Turkmenistan",     lat:40,   lng:60,    region:"Asia",            r:320 },
  { name:"United Arab Emirates", lat:24, lng:54,  region:"Asia",            r:180 },
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAME STATE
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
let gameMode    = null;
let totalRounds = 5;
let currentRound  = 0;
let totalScore    = 0;
let currentStreak = 0;
let roundResults  = [];
let queue         = [];
let currentTarget = null;
let timerInterval = null;
let timerSeconds  = 0;
let maxSeconds    = 20;
let guessLocked   = false;

// Leaflet map state
let leafletMap   = null;
let guessMarker  = null;
let answerMarker = null;
let distancePoly = null;

// Custom pin icons
const PIN_GUESS = L.divIcon({
  className: '',
  html: `<svg width="30" height="40" viewBox="0 0 30 40" style="display:block">
    <path d="M15 0 C7 0 1 6 1 14 C1 24 15 40 15 40 C15 40 29 24 29 14 C29 6 23 0 15 0Z"
          fill="#e8453c" stroke="#3b2f1e" stroke-width="2"/>
    <circle cx="15" cy="14" r="5" fill="white"/>
  </svg>`,
  iconSize: [30, 40], iconAnchor: [15, 40],
});

const PIN_ANSWER = L.divIcon({
  className: '',
  html: `<svg width="30" height="40" viewBox="0 0 30 40" style="display:block">
    <path d="M15 0 C7 0 1 6 1 14 C1 24 15 40 15 40 C15 40 29 24 29 14 C29 6 23 0 15 0Z"
          fill="#5cbb6f" stroke="#3b2f1e" stroke-width="2"/>
    <circle cx="15" cy="14" r="5" fill="white"/>
  </svg>`,
  iconSize: [30, 40], iconAnchor: [15, 40],
});

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UI HELPERS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showScreen(id) {
  document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
  document.getElementById(id).classList.add('active');
}

function selectMode(mode) {
  gameMode = mode;
  document.querySelectorAll('.mode-card').forEach(c => c.classList.remove('selected'));
  document.querySelector(`.mode-card[data-mode="${mode}"]`).classList.add('selected');
  const btn = document.getElementById('startBtn');
  btn.disabled = false;
  const labels = { states:'US States', cities:'US Cities', world:'Countries' };
  btn.textContent = `Start ${labels[mode]}! üöÄ`;
}

function setRounds(n, el) {
  totalRounds = n;
  document.querySelectorAll('.diff-btn').forEach(b => b.classList.remove('active'));
  el.classList.add('active');
}

function showStart() { showScreen('startScreen'); }

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// MAP ‚Äî Leaflet
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function initMap() {
  if (leafletMap) {
    leafletMap.remove();
    leafletMap = null;
    guessMarker = null; answerMarker = null; distancePoly = null;
  }

  leafletMap = L.map('mapContainer', { zoomControl: true, attributionControl: true, minZoom: 2 });

  L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_nolabels/{z}/{x}/{y}{r}.png', {
    attribution: '¬© <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> ¬© <a href="https://carto.com/attributions">CARTO</a>',
    subdomains: 'abcd', maxZoom: 19,
  }).addTo(leafletMap);

  setMapView();

  leafletMap.on('click', function (e) {
    if (guessLocked) return;
    placeGuess(e.latlng.lat, e.latlng.lng);
  });
}

function setMapView() {
  if (!leafletMap) return;
  if (gameMode === 'world') {
    leafletMap.setView([20, 10], 2);
  } else {
    leafletMap.fitBounds([[24, -125], [50, -66]]);
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SCORING
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function haversineKm(lat1, lng1, lat2, lng2) {
  const R = 6371;
  const dLat = (lat2 - lat1) * Math.PI / 180;
  const dLng = (lng2 - lng1) * Math.PI / 180;
  const a = Math.sin(dLat/2)**2 +
            Math.cos(lat1*Math.PI/180) * Math.cos(lat2*Math.PI/180) * Math.sin(dLng/2)**2;
  return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
}

function calcScore(distKm) {
  // Within the target's boundary radius ‚Üí perfect 1000
  const r       = currentTarget.r || 50;
  const maxDist = gameMode === 'world' ? 10000 : 4000;
  if (distKm <= r) return 1000;
  const raw = Math.max(0, 1 - (distKm - r) / (maxDist - r));
  return Math.round(raw * raw * 999); // caps at 999 just outside boundary
}

function scoreLabel(pts) {
  if (pts >= 1000) return { label:'üéØ Perfect!', cls:'perfect' };
  if (pts >= 700)  return { label:'‚≠ê Great!',   cls:'great'   };
  if (pts >= 400)  return { label:'üëç OK',        cls:'ok'      };
  return                  { label:'üìç Off',       cls:'poor'    };
}

function distanceDisplay(distKm) {
  if (distKm < 5) return 'Spot on!';
  if (gameMode === 'world') {
    if (distKm < 100) return `~${Math.round(distKm)} km away`;
    return `~${Math.round(distKm/100)*100} km away`;
  } else {
    const mi = distKm * 0.621371;
    if (mi < 20) return `~${Math.round(mi)} miles away`;
    return `~${Math.round(mi/50)*50} miles away`;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// GAME FLOW
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function startGame() {
  if (!gameMode) return;

  const pool = gameMode === 'states' ? US_STATES
             : gameMode === 'cities' ? US_CITIES
             : WORLD_COUNTRIES;

  queue         = shuffle([...pool]).slice(0, totalRounds);
  currentRound  = 0;
  totalScore    = 0;
  currentStreak = 0;
  roundResults  = [];

  document.getElementById('statTotal').textContent = totalRounds;

  showScreen('gameScreen');
  buildProgressDots();
  updateStats();

  requestAnimationFrame(() => { initMap(); loadQuestion(); });
}

function buildProgressDots() {
  const el = document.getElementById('progressDots');
  el.innerHTML = '';
  for (let i = 0; i < totalRounds; i++) {
    const d = document.createElement('div');
    d.className = 'progress-dot' + (i === 0 ? ' dot-current' : '');
    d.id = `dot-${i}`;
    el.appendChild(d);
  }
}

function updateProgressDots() {
  for (let i = 0; i < totalRounds; i++) {
    const d = document.getElementById(`dot-${i}`);
    if (!d) continue;
    d.className = 'progress-dot';
    if (i < currentRound) {
      const r = roundResults[i];
      if      (r && r.pts >= 1000) d.classList.add('dot-perfect');
      else if (r && r.pts >= 700)  d.classList.add('dot-great');
      else if (r && r.pts >= 400)  d.classList.add('dot-ok');
      else                         d.classList.add('dot-poor');
    } else if (i === currentRound) {
      d.classList.add('dot-current');
    }
  }
}

function updateStats() {
  document.getElementById('statScore').textContent  = totalScore.toLocaleString();
  document.getElementById('statRound').textContent  = currentRound + 1;
  document.getElementById('statStreak').textContent = currentStreak;
}

function loadQuestion() {
  if (currentRound >= totalRounds) { showEndScreen(); return; }

  currentTarget = queue[currentRound];
  guessLocked   = false;

  // Clear previous markers and line
  if (guessMarker)  { leafletMap.removeLayer(guessMarker);  guessMarker  = null; }
  if (answerMarker) { leafletMap.removeLayer(answerMarker); answerMarker = null; }
  if (distancePoly) { leafletMap.removeLayer(distancePoly); distancePoly = null; }

  document.getElementById('resultOverlay').classList.remove('show');
  document.getElementById('targetName').textContent = currentTarget.name;

  setMapView();
  updateProgressDots();
  updateStats();
  startTimer();
}

function startTimer() {
  clearInterval(timerInterval);
  timerSeconds = maxSeconds;
  const bar = document.getElementById('timerBar');
  bar.style.width = '100%';
  bar.className = 'timer-bar-fill';

  timerInterval = setInterval(() => {
    timerSeconds--;
    const pct = (timerSeconds / maxSeconds) * 100;
    bar.style.width = pct + '%';
    if (pct < 33)      bar.className = 'timer-bar-fill danger';
    else if (pct < 60) bar.className = 'timer-bar-fill warn';
    if (timerSeconds <= 0) { clearInterval(timerInterval); if (!guessLocked) timeUp(); }
  }, 1000);
}

function timeUp() {
  guessLocked = true;
  revealAnswer(null, null);
}

function placeGuess(lat, lng) {
  guessLocked = true;
  clearInterval(timerInterval);

  if (guessMarker) leafletMap.removeLayer(guessMarker);
  guessMarker = L.marker([lat, lng], { icon: PIN_GUESS }).addTo(leafletMap);

  revealAnswer(lat, lng);
}

function revealAnswer(guessLat, guessLng) {
  guessLocked = true;
  const target = currentTarget;

  if (answerMarker) leafletMap.removeLayer(answerMarker);
  answerMarker = L.marker([target.lat, target.lng], { icon: PIN_ANSWER }).addTo(leafletMap);

  let pts = 0, distKm = 0;

  if (guessLat !== null) {
    distKm = haversineKm(guessLat, guessLng, target.lat, target.lng);
    pts    = calcScore(distKm);

    const lineColor = pts >= 700 ? '#5cbb6f' : '#e8453c';
    if (distancePoly) leafletMap.removeLayer(distancePoly);
    distancePoly = L.polyline(
      [[guessLat, guessLng], [target.lat, target.lng]],
      { color: lineColor, weight: 2.5, dashArray: '8, 6', opacity: 0.9 }
    ).addTo(leafletMap);

    const bounds = L.latLngBounds([[guessLat, guessLng], [target.lat, target.lng]]);
    leafletMap.fitBounds(bounds, { padding: [70, 70], maxZoom: 8 });
  } else {
    leafletMap.setView([target.lat, target.lng], 4);
  }

  // Streak bonus
  if (pts >= 400) {
    currentStreak++;
    if (currentStreak >= 3) pts = Math.min(1000, Math.round(pts * 1.1));
  } else {
    currentStreak = 0;
  }

  totalScore += pts;
  roundResults.push({ name: target.name, pts, distKm, guessLat, guessLng });
  updateStats();

  const sl = scoreLabel(pts);
  document.getElementById('resultName').textContent = target.name;
  document.getElementById('resultDetail').textContent = guessLat === null
    ? `‚è±Ô∏è Time's up! It was in ${target.region}`
    : `${distanceDisplay(distKm)} ¬∑ ${target.region}${currentStreak >= 3 ? ' üî• Streak bonus!' : ''}`;

  const badge = document.getElementById('resultBadge');
  badge.textContent = `${sl.label} ${pts > 0 ? pts.toLocaleString() + ' pts' : ''}`;
  badge.className = `result-score-badge ${sl.cls}`;
  document.getElementById('resultOverlay').classList.add('show');
  document.getElementById('nextBtn').textContent = currentRound < totalRounds - 1 ? 'Next ‚Üí' : 'See Results!';
}

function nextQuestion(event) {
  if (event) event.stopPropagation();
  currentRound++;
  if (currentRound >= totalRounds) showEndScreen();
  else loadQuestion();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// END SCREEN
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function showEndScreen() {
  clearInterval(timerInterval);
  showScreen('endScreen');

  const maxPts = totalRounds * 1000;
  const pct    = totalScore / maxPts;

  let trophy = 'üèÜ', title = 'Great Explorer!';
  if      (pct >= 0.9)  { trophy = 'ü•á'; title = 'Geography Master!'; }
  else if (pct >= 0.75) { trophy = 'üèÜ'; title = 'Great Explorer!';   }
  else if (pct >= 0.5)  { trophy = 'ü•à'; title = 'Getting There!';    }
  else if (pct >= 0.25) { trophy = 'ü•â'; title = 'Keep Exploring!';   }
  else                  { trophy = 'üó∫Ô∏è'; title = 'Time to Study!';    }

  document.getElementById('endTrophy').textContent     = trophy;
  document.getElementById('endTitle').textContent      = title;
  document.getElementById('endFinalScore').textContent = totalScore.toLocaleString() + ' pts';

  const rankLabels = [
    { min:0.9,  label:'üåü World-class navigator' },
    { min:0.75, label:'‚úàÔ∏è Seasoned traveler'     },
    { min:0.5,  label:'üß≠ Curious explorer'       },
    { min:0.25, label:'üó∫Ô∏è Rookie cartographer'   },
    { min:0,    label:'üìö Keep studying!'          },
  ];
  document.getElementById('endRank').textContent = rankLabels.find(r => pct >= r.min).label;

  const rows = document.getElementById('breakdownRows');
  rows.innerHTML = '';
  roundResults.forEach((r, i) => {
    const sl  = scoreLabel(r.pts);
    const row = document.createElement('div');
    row.className = 'breakdown-row';
    row.style.animationDelay = (i * 0.07) + 's';
    row.innerHTML = `
      <span class="breakdown-name">${i+1}. ${r.name}</span>
      <span class="breakdown-dist">${r.guessLat !== null ? distanceDisplay(r.distKm) : "Time's up"}</span>
      <span class="breakdown-pts pts-${sl.cls}">${r.pts.toLocaleString()}</span>
    `;
    rows.appendChild(row);
  });

  if (pct >= 0.75) launchConfetti();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CONFETTI
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function launchConfetti() {
  const canvas = document.getElementById('confettiCanvas');
  const ctx    = canvas.getContext('2d');
  canvas.width = window.innerWidth; canvas.height = window.innerHeight;

  const colors = ['#f7c948','#5cbb6f','#4a90d9','#e8453c','#9b6fda','#f5832a','#e8668a','#3dbfb0'];
  const pieces = Array.from({length:120}, () => ({
    x: Math.random()*canvas.width, y: Math.random()*-canvas.height,
    r: 4+Math.random()*6, color: colors[Math.floor(Math.random()*colors.length)],
    vx:(Math.random()-.5)*3, vy:2+Math.random()*4,
    rot:Math.random()*360, rotV:(Math.random()-.5)*8,
    shape: Math.random()>.5?'rect':'circle'
  }));

  let frame = 0;
  (function draw() {
    if (frame > 200) { ctx.clearRect(0,0,canvas.width,canvas.height); return; }
    ctx.clearRect(0,0,canvas.width,canvas.height);
    pieces.forEach(p => {
      ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot*Math.PI/180);
      ctx.fillStyle = p.color; ctx.globalAlpha = Math.max(0,1-frame/180);
      if (p.shape==='circle') { ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill(); }
      else { ctx.fillRect(-p.r,-p.r/2,p.r*2,p.r); }
      ctx.restore();
      p.x+=p.vx; p.y+=p.vy; p.rot+=p.rotV; p.vy+=0.05;
    });
    frame++; requestAnimationFrame(draw);
  })();
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILITIES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function shuffle(arr) {
  for (let i = arr.length-1; i > 0; i--) {
    const j = Math.floor(Math.random()*(i+1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
</script>
</body>
</html>
